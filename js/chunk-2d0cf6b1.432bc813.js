(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cf6b1"],{6441:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("DPageContent",[r("el-row",{staticClass:"d-row"},[r("el-card",{attrs:{shadow:"never"}},[r("el-select",{staticStyle:{width:"250px"},attrs:{filterable:"",remote:"",placeholder:"请输入用户名或姓名,例如xiao",size:"small","remote-method":e.searchUser},on:{change:e.selectUser},model:{value:e.currentUserName,callback:function(t){e.currentUserName=t},expression:"currentUserName"}},e._l(e.searchUserList,function(e){return r("el-option",{key:e.userName,attrs:{label:e.userNameCn+"("+e.userName+")",value:e.userName}})}),1)],1)],1),r("el-row",{staticClass:"d-row"},[r("el-card",{attrs:{shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"d-card-title"},[e._v("基本信息")])]),r("DDetail",{attrs:{data:e.currentUserBase,columns:e.detailColumns}})],1)],1),r("el-row",{staticClass:"d-row"},[r("UserRole",{attrs:{userName:e.currentUserName,userNameCn:e.currentUserBase.userNameCn}})],1),r("el-row",{staticClass:"d-row"},[r("UserCity",{attrs:{userName:e.currentUserName}})],1)],1)},s=[],o=r("f958"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",{attrs:{shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"d-card-title"},[e._v("角色权限")]),e.userName?r("DEditSaveSwitch",{staticStyle:{float:"right"},attrs:{editName:"授权"},on:{submit:e.submitRoleGrantedForm,edit:e.openRoleGrantedForm},model:{value:e.roleGranting,callback:function(t){e.roleGranting=t},expression:"roleGranting"}}):e._e()],1),e.roleGranting?r("div",[r("el-row",{staticClass:"d-row"},[r("el-col",{attrs:{span:4}},[r("el-input",{attrs:{"suffix-icon":"el-icon-search",size:"small",clearable:"",placeholder:"请输入角色名搜索"},on:{change:e.searchGrantRole},model:{value:e.searchRoleKey,callback:function(t){e.searchRoleKey="string"===typeof t?t.trim():t},expression:"searchRoleKey"}})],1)],1),e._l(e.searchedRoleList,function(t,i){return r("el-row",{key:i,staticClass:"d-row"},[r("el-col",{attrs:{span:2}},[r("span",{staticClass:"d-desclist-index-term"},[e._v(e._s(t.projName))])]),r("el-col",{attrs:{span:22}},[r("el-checkbox-group",{on:{change:function(r){e.changeCheckedRole(r,t)}},model:{value:e.checkedRoleObj[t.projId],callback:function(r){e.$set(e.checkedRoleObj,t.projId,r)},expression:"checkedRoleObj[item.projId]"}},e._l(t.roleList,function(t,i){return r("el-checkbox",{key:i,attrs:{label:t.roleId,disabled:t.disable}},[e._v(e._s(t.roleName))])}),1)],1)],1)})],2):r("div",e._l(e.projRoleGrantedList,function(t,i){return r("el-row",{key:i,staticClass:"d-row"},[r("el-col",{attrs:{span:2}},[r("span",{staticClass:"d-desclist-index-term"},[e._v(e._s(t.projName))])]),r("el-col",{attrs:{span:22}},[r("el-row",e._l(t.roleList,function(t,i){return r("el-col",{key:i,attrs:{span:3}},[r("span",{staticClass:"d-desclist-index-detail"},[e._v(e._s(t.roleName))])])}),1)],1)],1)}),1)])},n=[],c=(r("456d"),r("6762"),r("2fdb"),r("8615"),r("20d6"),r("ac6a"),r("0213")),l={name:"UserRole",props:{userName:String,userNameCn:String},data:function(){return{projRoleGrantedList:[],projRoleGrantedObj:{},checkedRoleObj:{},roleGranting:!1,allProjRoleObj:null,allProjRoleForm:{},searchRoleKey:"",searchedRoleList:[]}},watch:{userName:function(){this.setRoleGrantedList()}},methods:{setRoleGrantedList:function(){var e=this;this.roleGranting=!1,this.projRoleGrantedList=[],this.projRoleGrantedObj={},Object(o["f"])({userName:this.userName}).then(function(t){e.projRoleGrantedList=t.data,e.projRoleGrantedList.forEach(function(t){e.projRoleGrantedObj[t.projId]=t.roleList})}).catch(this.$handleError)},setAllProjRoleObj:function(){var e=this;this.allProjRoleObj?this.setAllProjRoleForm():(this.allProjRoleObj={},Object(c["m"])().then(function(t){t.data.forEach(function(t){e.allProjRoleObj[t.projId]=t}),e.setAllProjRoleForm()}).catch(this.$handleError))},openRoleGrantedForm:function(){this.searchRoleKey="",this.setAllProjRoleObj()},setAllProjRoleForm:function(){var e=this;this.checkedRoleObj={},this.allProjRoleForm={},this.projRoleGrantedList.forEach(function(t){e.checkedRoleObj[t.projId]=t.roleList.map(function(e){return e.roleId}),e.allProjRoleForm[t.projId]={projId:t.projId,projName:t.projName,roleList:[]},e.allProjRoleObj[t.projId]?(e.allProjRoleForm[t.projId].roleList=e.allProjRoleObj[t.projId].roleList.map(function(e){return{roleId:e.roleId,roleName:e.roleName}}),t.roleList.forEach(function(r){-1===e.allProjRoleForm[t.projId].roleList.findIndex(function(e){return e.roleId===r.roleId})&&e.allProjRoleForm[t.projId].roleList.push({roleId:r.roleId,roleName:r.roleName,disable:!0})})):e.allProjRoleForm[t.projId].roleList=t.roleList.map(function(e){return{roleId:e.roleId,roleName:e.roleName,disable:!0}})}),Object.values(this.allProjRoleObj).forEach(function(t){e.allProjRoleForm[t.projId]||(e.checkedRoleObj[t.projId]=[],e.allProjRoleForm[t.projId]={projId:t.projId,projName:t.projName,roleList:[]},e.allProjRoleForm[t.projId].roleList=e.allProjRoleObj[t.projId].roleList.map(function(e){return{roleId:e.roleId,roleName:e.roleName}}))}),this.searchGrantRole()},searchGrantRole:function(){var e=this;this.searchedRoleList=[],this.searchRoleKey?Object.values(this.allProjRoleForm).forEach(function(t){var r=t.roleList.filter(function(t){return t.roleName.includes(e.searchRoleKey)});r.length&&e.searchedRoleList.push({projId:t.projId,projName:t.projName,roleList:r})}):this.searchedRoleList=Object.values(this.allProjRoleForm)},changeCheckedRole:function(e,t){this.$forceUpdate()},submitRoleGrantedForm:function(){var e=this,t=[],r=[];Object.keys(this.checkedRoleObj).forEach(function(i){var s=e.checkedRoleObj[i];e.projRoleGrantedObj[i]&&e.projRoleGrantedObj[i].forEach(function(e){s.includes(e.roleId)||r.push(e.roleUserId)}),s.forEach(function(r){var s=-1;e.projRoleGrantedObj[i]&&(s=e.projRoleGrantedObj[i].findIndex(function(e){return e.roleId===r})),-1===s&&t.push(r)})}),Object(o["d"])({userName:this.userName,userNameCn:this.userNameCn,addRoleIdList:t.toString(),delRelationIdList:r.toString()}).then(function(t){e.setRoleGrantedList()}).catch(this.$handleError)}}},d=l,h=r("2877"),u=Object(h["a"])(d,a,n,!1,null,null,null),p=u.exports,f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-card",{attrs:{shadow:"never"}},[r("div",{attrs:{slot:"header"},slot:"header"},[r("span",{staticClass:"d-card-title"},[e._v("城市权限")]),e.userName?r("DEditSaveSwitch",{staticStyle:{float:"right"},attrs:{editName:"授权"},on:{submit:e.submitCityGrantedForm,edit:e.openCityGrantedForm},model:{value:e.cityGranting,callback:function(t){e.cityGranting=t},expression:"cityGranting"}}):e._e()],1),e.cityGranting?r("div",[r("el-row",{staticClass:"d-row"},[r("el-col",{attrs:{span:4}},[r("el-input",{attrs:{"suffix-icon":"el-icon-search",size:"small",clearable:"",placeholder:"请输入城市名搜索"},on:{change:e.searchGrantCity},model:{value:e.searchCityKey,callback:function(t){e.searchCityKey="string"===typeof t?t.trim():t},expression:"searchCityKey"}})],1)],1),r("el-row",{staticClass:"d-row"},[r("el-col",{attrs:{span:2}},[r("el-checkbox",{model:{value:e.wholeCountry,callback:function(t){e.wholeCountry=t},expression:"wholeCountry"}},[e._v("全国")])],1)],1),e._l(e.searchedCityList,function(t,i){return r("el-row",{key:i,staticClass:"d-row"},[r("el-col",{attrs:{span:2}},[r("el-checkbox",{on:{change:function(r){return e.changeProvinceChecked(r,t)}},model:{value:e.provincesChecked[t.id],callback:function(r){e.$set(e.provincesChecked,t.id,r)},expression:"provincesChecked[item.id]"}},[e._v(e._s(t.name))])],1),r("el-col",{attrs:{span:22}},[r("el-checkbox-group",{on:{change:function(r){e.changeCheckedCity(r,t)}},model:{value:e.checkedCityList,callback:function(t){e.checkedCityList=t},expression:"checkedCityList"}},e._l(t.cityList,function(t,i){return r("el-checkbox",{key:i,attrs:{label:t.id}},[e._v(e._s(t.name))])}),1)],1)],1)})],2):r("div",[r("el-row",{staticClass:"d-row"},e._l(e.userCityGrantedList,function(t,i){return r("el-col",{key:i,attrs:{span:1}},[r("span",{staticClass:"d-desclist-index-detail"},[e._v(e._s(t.cityName))])])}),1)],1)])},y=[],m=(r("7f7f"),r("7eee")),C={name:"UserCity",props:{userName:String},watch:{userName:function(){this.setCityGrantedList()}},data:function(){return{userCityGrantedList:[],userCityGrantedMap:{},cityGranting:!1,provinceCityList:null,checkedCityList:[],searchCityKey:"",searchedCityList:[],wholeCountry:!1,provincesChecked:{},cityMap:{}}},methods:{setCityGrantedList:function(){var e=this;this.cityGranting=!1,this.checkedCityList=[],Object(o["e"])({userName:this.userName}).then(function(t){e.userCityGrantedList=t.data,e.userCityGrantedList.forEach(function(t){e.userCityGrantedMap[t.cityId]=t,t.cityId===m["b"].id?e.wholeCountry=!0:e.checkedCityList.push(t.cityId)}),e.wholeCountry&&(e.checkedCityList=[m["b"].id])}).catch(this.$handleError)},openCityGrantedForm:function(){this.cityGranting=!0,this.searchCityKey="",this.setProvinceCityList()},setProvinceCityList:function(){var e=this;this.provinceCityList?this.searchGrantCity():Object(m["c"])().then(function(t){e.provinceCityList=t.data,e.setCityMap(),e.searchGrantCity()}).catch(this.$handleError)},setCityMap:function(){var e=this;this.cityMap[m["b"].id]=m["b"],this.provinceCityList.forEach(function(t){t.cityList.forEach(function(t){e.cityMap[t.id]=t})})},searchGrantCity:function(){var e=this;this.searchedCityList=[],this.searchCityKey?this.provinceCityList.forEach(function(t){var r=[];t.cityList.forEach(function(t){t.name.includes(e.searchCityKey)&&r.push(t)}),r.length&&e.searchedCityList.push({id:t.id,name:t.name,cityList:r})}):this.searchedCityList=this.provinceCityList,this.setProvincesChecked()},setProvincesChecked:function(){var e=this;this.searchedCityList.forEach(function(t){e.setProvinceChecked(t)})},setProvinceChecked:function(e){for(var t in this.provincesChecked[e.id]=!0,e.cityList)if(!this.checkedCityList.includes(e.cityList[t].id)){this.provincesChecked[e.id]=!1;break}},uncheckedWholeCountry:function(){this.wholeCountry=!1;var e=this.checkedCityList.findIndex(function(e){return e===m["b"].id});e>=0&&this.checkedCityList.splice(e,1)},changeCheckedCity:function(e,t){this.uncheckedWholeCountry(),this.setProvinceChecked(t),this.$forceUpdate()},changeProvinceChecked:function(e,t){var r=this;if(this.uncheckedWholeCountry(),e)t.cityList.forEach(function(e){r.checkedCityList.includes(e.id)||r.checkedCityList.push(e.id)});else{var i=[];this.checkedCityList.forEach(function(e,r){var s=t.cityList.findIndex(function(t){return t.id===e});s>=0&&i.push(r)}),i.forEach(function(e,t){r.checkedCityList.splice(e-t,1)})}},submitCityGrantedForm:function(){var e=this,t=[],r=[];this.checkedCityList.forEach(function(r){e.userCityGrantedMap[r]||t.push({cityId:e.cityMap[r].id,cityName:e.cityMap[r].name})}),this.userCityGrantedList.forEach(function(t){e.checkedCityList.includes(t.cityId)||r.push(t.id)}),Object(o["c"])({userName:this.userName,addCityList:JSON.stringify(t),delRelationIdList:r.toString()}).then(function(t){e.setCityGrantedList()}).catch(this.$handleError)}}},j=C,v=Object(h["a"])(j,f,y,!1,null,null,null),L=v.exports,b={name:"DUser",components:{UserRole:p,UserCity:L},data:function(){return{currentUserName:"",currentUserBase:{},detailColumns:[{key:"userNameCn",title:"姓名"},{key:"userName",title:"用户名"},{key:"departmentName",title:"部门"},{key:"phone",title:"手机号"},{key:"email",title:"邮箱"}],searchUserList:[]}},methods:{searchUser:function(e){var t=this;e&&Object(o["g"])({keyword:e}).then(function(e){t.searchUserList=e.data}).catch(this.$handleError)},selectUser:function(){this.setCurrentUserBase()},setCurrentUserBase:function(){var e=this;Object(o["b"])({userName:this.currentUserName}).then(function(t){e.currentUserBase=t.data}).catch(this.$handleError)}}},k=b,R=Object(h["a"])(k,i,s,!1,null,null,null);t["default"]=R.exports}}]);
//# sourceMappingURL=chunk-2d0cf6b1.432bc813.js.map