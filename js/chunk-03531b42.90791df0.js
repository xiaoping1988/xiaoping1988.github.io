(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03531b42"],{"03fb":function(t,e,i){},"0876":function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.previewData?i("div",[i("div",{staticClass:"head"},[t._v("\n        显示最新\n        "),i("span",{staticClass:"d-strong-count"},[t._v(t._s(t.previewData.data.length))]),t._v("\n        条数据,数据最后更新时间\n        "),i("span",{staticClass:"d-strong-count"},[t._v(t._s(t.previewData.lastDataModifiedTime))])]),i("el-table",{attrs:{data:t.previewData.data,height:"400",width:"100%"}},t._l(t.previewData.colList,function(e){return i("el-table-column",{key:e.colName,attrs:{prop:e.colName,label:e.colLabel,width:e.width},scopedSlots:t._u([{key:"header",fn:function(e){return[i("i",{staticClass:"d-icon fa",class:"fa-"+t.dataTypeObj[t.colObj[e.column.property].dataType].icon}),i("span",[t._v(t._s(e.column.label))])]}}],null,!0)})}),1),i("DLoading",{attrs:{loading:t.loading}})],1):t._e()},n=[],a=(i("ac6a"),i("c5f6"),i("8a52")),s=i("76bd"),l=(i("0b85"),{name:"DPreviewTable",props:{tbId:[String,Number]},data:function(){return{dataTypeObj:s["b"],previewData:null,colObj:{},maxColWidth:250,minColWidth:150}},methods:{preview:function(){var t=this;this.previewData||(this.loading=!1,Object(a["i"])({id:this.tbId}).then(function(e){t.previewData=e.data,t.previewData.colList.forEach(function(e){t.colObj[e.colName]=e}),t.loading=!1}).catch(this.$handleError))}},watch:{tbId:function(){this.previewData=null,this.preview()}},mounted:function(){this.preview()}}),c=l,r=i("2877"),d=Object(r["a"])(c,o,n,!1,null,null,null);e["a"]=d.exports},"100b":function(t,e,i){"use strict";var o=i("75ff"),n=i.n(o);n.a},1729:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-design"},[i("div",{staticClass:"head"},[t._m(0),i("div",{staticClass:"form-btn"},[i("DSubmitCancel",{attrs:{nohr:"",size:"mini"},on:{submit:t.submit,cancel:t.cancel}})],1)]),i("div",{staticClass:"panel"},[i("div",{staticClass:"d-chart-design-left"},[i("DWorkTable",{attrs:{tbId:t.tbId}})],1),i("div",{staticClass:"d-chart-design-main"},[i("DDimModule"),i("DMeasureModule"),i("div",{staticClass:"bottom"},[i("DDefaultFilterModule"),i("DChartPreviewModule")],1)],1),t._m(1)])])},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"title"},[i("h2",[t._v("设计图表")])])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-design-right"},[i("div",{staticClass:"module-title"},[t._v("\n                图表名称\n            ")]),i("div",{staticClass:"module-title"},[t._v("\n                图表类型\n            ")]),i("div",{staticClass:"module-title"},[t._v("\n                图内筛选\n            ")]),i("div",{staticClass:"module-title"},[t._v("\n                图表备注\n            ")])])}],a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-work-table"},[i("div",{staticClass:"table"},[i("div",{staticClass:"module-title"},[t._v("\n            工作表\n        ")]),i("div",{staticClass:"table-name-panel"},[i("div",{staticClass:"table-name d-ellipsis",attrs:{title:t.tbInfo.tbNameCn},on:{click:t.openPreviewTable}},[t._v(t._s(t.tbInfo.tbNameCn))]),i("div",{staticClass:"exchange-table",attrs:{title:"切换工作表"},on:{click:t.openExchangeTable}},[i("i",{staticClass:"fa fa-exchange"})])])]),i("div",{staticClass:"column"},[t._m(0),i("div",{staticClass:"search"},[i("el-input",{staticClass:"d-visual-input",attrs:{size:"mini",clearable:"",placeholder:"搜索字段","suffix-icon":"el-icon-search"},model:{value:t.colKeyword,callback:function(e){t.colKeyword="string"===typeof e?e.trim():e},expression:"colKeyword"}})],1),i("ul",{staticClass:"col-list"},[t._l(t.searchedColList,function(e){return i("li",{key:e.colName},[i("div",{staticClass:"col-item",attrs:{title:e.colName,draggable:"true"},on:{click:function(i){return t.toggleShowTimeFreq(e)},dragstart:function(i){return t.dragColStart(i,e)},dragover:function(e){return t.allowDrop(e)}}},[i("div",{staticClass:"pre-icon"},[i("i",{staticClass:"fa",class:"fa-"+t.dataTypeObj[e.dataType].icon})]),i("div",{staticClass:"col-label d-ellipsis"},[t._v("\n                        "+t._s(e.colLabel)+"\n                    ")])])])}),t._l(t.searchedLogicColList,function(e,o){return i("li",{key:o},[i("div",{staticClass:"col-item",attrs:{title:e.colName,draggable:"true"},on:{dragstart:function(i){return t.dragColStart(i,e)},dragover:function(e){return t.allowDrop(e)}}},[i("div",{staticClass:"pre-icon new-col"},[i("i",{staticClass:"fa",class:"fa-"+t.dataTypeObj[e.dataType].icon})]),i("div",{staticClass:"col-label d-ellipsis"},[t._v("\n                        "+t._s(e.colLabel)+"\n                    ")])])])})],2)]),i("DLoading",{attrs:{loading:t.loading}}),i("el-dialog",{attrs:{visible:t.showPreviewModal,title:"预览数据",top:"30px",width:"70%"},on:{"update:visible":function(e){t.showPreviewModal=e}}},[t.showPreviewModal?i("DPreviewTable",{attrs:{tbId:this.currentTbId}}):t._e()],1),i("el-dialog",{attrs:{visible:t.showExchangeModal,title:"切换工作表",top:"30px",width:"360px"},on:{"update:visible":function(e){t.showExchangeModal=e}}},[t.showExchanged?i("DWorkTableSelect",{on:{select:t.exchangeTable}}):t._e()],1)],1)},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"head"},[i("div",{staticClass:"module-title"},[t._v("\n                字段\n            ")]),i("div",{staticClass:"col-btn"},[i("i",{staticClass:"el-icon-plus"}),i("ul",{staticClass:"d-btn-list"},[i("li",[t._v("添加计算字段")])])])])}],l=(i("6762"),i("2fdb"),i("ac6a"),i("8615"),i("c5f6"),i("8a52")),c=i("76bd"),r=i("0876"),d=i("d45b"),u=i("6f7f"),f={name:"DWorkTable",components:{DPreviewTable:r["a"],DWorkTableSelect:d["a"]},props:{tbId:[String,Number]},data:function(){return{loading:!1,currentTbId:this.tbId,timeFreqList:Object.values(u["m"]),dataTypeObj:c["b"],showPreviewModal:!1,showPreviewed:!1,showExchangeModal:!1,showExchanged:!1,tbInfo:{},logicColList:[],searchedColList:[],searchedLogicColList:[],colKeyword:""}},methods:{initData:function(){this.setTbInfo()},setTbInfo:function(){var t=this;this.loading=!0,Object(l["d"])({id:this.currentTbId}).then(function(e){t.tbInfo=e.data,t.tbInfo.logicColList.forEach(function(t){return t.isNewCol=!0}),t.updateWorkTableStore(),t.loading=!1,t.searchColList()}).catch(this.$handleError)},updateWorkTableStore:function(){this.$store.commit("GeneralChart/updateWorkTable",this.tbInfo)},searchColList:function(){var t=this;""===this.colKeyword?(this.searchedColList=this.tbInfo.colList,this.searchedLogicColList=this.tbInfo.logicColList):(this.searchedColList=this.tbInfo.colList.filter(function(e){return e.colName.includes(t.colKeyword.toLowerCase())||e.colLabel.includes(t.colKeyword)}),this.searchedLogicColList=this.tbInfo.logicColList.filter(function(e){return e.colName.includes(t.colKeyword.toLowerCase())||e.colLabel.includes(t.colKeyword)}))},openPreviewTable:function(){this.showPreviewModal=!0,this.showPreviewed=!0},openExchangeTable:function(){this.showExchangeModal=!0,this.showExchanged=!0},exchangeTable:function(t){this.showExchangeModal=!1,this.currentTbId=t.id},toggleShowTimeFreq:function(t){t.dataType===c["b"].date.code&&(t.showTimeFreq=!t.showTimeFreq,this.$forceUpdate())},allowDrop:function(t){t.preventDefault()},dragColStart:function(t,e){t.dataTransfer.setData("dragingCol",JSON.stringify(e))}},watch:{tbId:function(){this.currentTbId=this.tbId},currentTbId:function(){this.currentTbId&&this.initData()},colKeyword:function(){this.searchColList()}}},m=f,h=(i("c82b"),i("2877")),p=Object(h["a"])(m,a,s,!1,null,null,null),b=p.exports,C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-dim"},[i("div",{staticClass:"d-col-container"},[i("div",{staticClass:"label"},[i("span",[t._v("维度")]),i("i",{staticClass:"fa fa-pencil",attrs:{title:"批量添加"},on:{click:function(e){return t.openBatchAdd(0)}}})]),i("DDimDragContainer",{on:{change:t.changeDimStore,"click-item":t.openConfig},model:{value:t.dimList,callback:function(e){t.dimList=e},expression:"dimList"}}),t.hasContrast?t._e():i("div",{staticClass:"right-btn",on:{click:t.addContrast}},[i("span",[t._v("添加对比")])])],1),t.hasContrast?i("div",{staticClass:"d-col-container"},[i("div",{staticClass:"label"},[i("span",[t._v("对比")]),i("i",{staticClass:"fa fa-pencil",attrs:{title:"批量添加"},on:{click:function(e){return t.openBatchAdd(1)}}})]),i("DDimDragContainer",{on:{change:t.changeDimStore,"click-item":t.openConfig},model:{value:t.contrastDimList,callback:function(e){t.contrastDimList=e},expression:"contrastDimList"}}),i("div",{staticClass:"right-btn",on:{click:t.removeContrast}},[i("span",[t._v("移除对比")])])],1):t._e(),i("el-dialog",{attrs:{visible:t.configModalVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"400px"},on:{"update:visible":function(e){t.configModalVisible=e}}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[i("span",{staticStyle:{color:"#1c2438","font-weight":"700"}},[t._v("维度配置:")]),i("span",{staticStyle:{color:"#be3330"}},[t._v(t._s(t.currentConfigCol.colConfig.showName))]),i("span",{staticStyle:{color:"#1c2438","font-weight":"700","margin-left":"10px"}},[t._v("原始名称:")]),i("span",{staticStyle:{color:"#be3330"}},[t._v(t._s(t.currentConfigCol.colLabel))])])]),i("el-tabs",{model:{value:t.activeConfigTab,callback:function(e){t.activeConfigTab=e},expression:"activeConfigTab"}},[t.currentConfigCol.colConfig.timeFreq?i("el-tab-pane",{attrs:{label:"粒度",name:"tf"}},[i("el-radio-group",{model:{value:t.configForm.timeFreq,callback:function(e){t.$set(t.configForm,"timeFreq",e)},expression:"configForm.timeFreq"}},t._l(t.timeFreqList,function(e){return i("div",{key:e.code,staticClass:"vertical"},[i("el-radio",{attrs:{label:e.code}},[t._v("按"+t._s(e.name))])],1)}),0)],1):t._e(),i("el-tab-pane",{attrs:{label:"字段设置",name:"bs"}},[i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"dim-bs-form-label"},[i("span",[t._v("显示名称")])]),i("div",{staticClass:"dim-bs-form-input"},[i("el-input",{attrs:{size:"mini",placeholder:t.currentConfigCol.colLabel},model:{value:t.configForm.showName,callback:function(e){t.$set(t.configForm,"showName",e)},expression:"configForm.showName"}})],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"dim-bs-form-label"},[i("span",[t._v("排序方式")])]),i("div",{staticClass:"dim-bs-form-input"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.configForm.sortType,callback:function(e){t.$set(t.configForm,"sortType",e)},expression:"configForm.sortType"}},[i("el-option",{attrs:{value:"0",label:"默认"}}),i("el-option",{attrs:{value:"asc",label:"正序"}}),i("el-option",{attrs:{value:"desc",label:"倒序"}})],1)],1)])],1)],1),i("DSubmitCancel",{attrs:{slot:"footer",nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submitConfigForm,cancel:function(e){t.configModalVisible=!1}},slot:"footer"})],1),i("el-dialog",{attrs:{title:"批量添加"+(0===t.batchAddTargetType?"维度":"对比")+"字段",visible:t.batchAddModalVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"600px"},on:{"update:visible":function(e){t.batchAddModalVisible=e}}},[i("DBatchAddCol",{on:{submit:t.submitBatchAdd,cancel:function(e){t.batchAddModalVisible=!1}}})],1)],1)},g=[],v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("DDraggableContainer",{staticClass:"d-drag-container",attrs:{horizontal:"",disabled:"",noDataText:"从左侧字段列表拖拽字段到这里"},on:{drop:t.dragDropCol},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.item,n=e.index;return[o?i("div",{staticClass:"tag-item"},[i("div",{on:{click:function(e){return t.openConfig(o)}}},[i("span",[t._v(t._s(o.colConfig.showName))]),o.colConfig.timeFreq?i("span",[t._v("(按"+t._s(t.timeFreqObj[o.colConfig.timeFreq].name)+")")]):t._e()]),i("div",{staticClass:"btn"},[i("i",{staticClass:"fa fa-times-circle",attrs:{title:"移除字段"},on:{click:function(e){return t.removeCol(n)}}})])]):t._e()]}}]),model:{value:t.dimList,callback:function(e){t.dimList=e},expression:"dimList"}})},T=[],w=function(t){return{key:t.colName+"_"+(new Date).getTime(),showName:t.colLabel,showType:t.dataType===c["b"].num.code?u["i"].num.code:u["i"].text.code,sortType:"0",timeFreq:t.dataType===c["b"].date.code?u["m"].day.code:""}},y=function(t){return{key:t.colName+"_"+(new Date).getTime(),showName:t.colLabel,sortType:"0",aggFunction:t.dataType===c["b"].num.code?u["a"].sum.code:u["a"].count.code,unit:"",divisor:1,showType:u["i"].num.code,THB:[],THBValueType:"",THBTimeCol:""}},F=function(t){var e="",i="",o=-1;return t.dataType===c["b"].text.code?e=u["e"].accurate.code:t.dataType===c["b"].num.code?e=u["e"].condition.code:(e=u["e"].time.code,i=c["b"][t.dataType].defaultTimeFreq,o=u["m"][i].rangeDefaultDateNum),{filterPanelType:e,timeFreq:i,relativeTimeNum:o,conditionSpliceType:u["c"].and.code,showCondition:!0}},_={name:"DDimDragContainer",props:{value:{type:Array,default:function(){return[]}}},data:function(){return{dimList:this.value,timeFreqObj:u["m"]}},watch:{value:function(){this.dimList=this.value}},methods:{openConfig:function(t){this.$emit("click-item",t)},removeCol:function(t){this.dimList.splice(t,1),this.$emit("change",this.dimList)},allowDrop:function(t){t.preventDefault()},dragDropCol:function(t){var e=this.getDragingCol(t);this.dimList.push(e),this.$emit("change",this.dimList)},getDragingCol:function(t){var e=t.dataTransfer.getData("dragingCol");return e=JSON.parse(e),e.colConfig=w(e),e}}},L=_,D=Object(h["a"])(L,v,T,!1,null,null,null),k=D.exports,x=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"100%"}},[i("el-row",{staticClass:"d-row"},[i("el-col",{attrs:{span:8}},[i("el-input",{attrs:{"suffix-icon":"el-icon-search",size:"small",clearable:"",placeholder:"请输入关键字搜索"},model:{value:t.searchColKey,callback:function(e){t.searchColKey="string"===typeof e?e.trim():e},expression:"searchColKey"}})],1)],1),t._l(t.searchedColList,function(e,o){return i("el-row",{key:o,staticClass:"d-row"},[i("el-col",{attrs:{span:5}},[i("el-checkbox",{on:{change:function(i){return t.changeDataTypeChecked(i,e)}},model:{value:t.dataTypeChecked[e.code],callback:function(i){t.$set(t.dataTypeChecked,e.code,i)},expression:"dataTypeChecked[item.code]"}},[i("i",{staticClass:"fa d-icon",class:"fa-"+e.icon}),i("span",[t._v(t._s(e.name))])])],1),i("el-col",{attrs:{span:19}},[i("el-checkbox-group",{on:{change:function(i){t.changeCheckedCol(i,e)}},model:{value:t.checkedColList,callback:function(e){t.checkedColList=e},expression:"checkedColList"}},t._l(e.colList,function(e,o){return i("el-checkbox",{key:o,attrs:{label:e.colName}},[t._v(t._s(e.colLabel))])}),1)],1)],1)}),i("el-row",[i("DSubmitCancel",{attrs:{nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submit,cancel:t.cancel}})],1)],2)},S=[],N=(i("20d6"),{name:"DBatchAddCol",data:function(){return{searchedColList:[],searchColKey:"",checkedColList:[],dataTypeChecked:{}}},methods:{submit:function(){var t=this.$store.state.GeneralChart.workTableColList,e=[];this.checkedColList.forEach(function(i){var o=t.filter(function(t){return t.colName===i})[0],n=JSON.parse(JSON.stringify(o));e.push(n)}),this.initFormData(),this.$emit("submit",e)},cancel:function(){this.initFormData(),this.$emit("cancel")},initFormData:function(){this.checkedColList=[],this.dataTypeChecked={date:!1,text:!1,num:!1},this.searchColKey=""},searchColList:function(){var t=this,e=this.$store.state.GeneralChart.workTableColList,i=[],o=[],n=[],a=[];a=this.searchColKey?e.filter(function(e){return e.colName.includes(t.searchColKey.toLowerCase())||e.colLabel.includes(t.searchColKey)}):e,a.forEach(function(t){t.dataType===c["b"].date.code?i.push(t):t.dataType===c["b"].num.code?n.push(t):o.push(t)});var s=[];i.length&&s.push({code:c["b"].date.code,name:"日期",icon:c["b"].date.icon,colList:i}),o.length&&s.push({code:c["b"].text.code,name:"文本",icon:c["b"].text.icon,colList:o}),n.length&&s.push({code:c["b"].num.code,name:"数值",icon:c["b"].num.icon,colList:n}),this.searchedColList=s},setDataTypeChecked:function(t){for(var e in this.dataTypeChecked[t.code]=!0,t.colList)if(!this.checkedColList.includes(t.colList[e].colName)){this.dataTypeChecked[t.code]=!1;break}},changeCheckedCol:function(t,e){this.setDataTypeChecked(e),this.$forceUpdate()},changeDataTypeChecked:function(t,e){var i=this;if(t)e.colList.forEach(function(t){i.checkedColList.includes(t.colName)||i.checkedColList.push(t.colName)});else{var o=[];this.checkedColList.forEach(function(t,i){var n=e.colList.findIndex(function(e){return e.colName===t});n>=0&&o.push(i)}),o.forEach(function(t,e){i.checkedColList.splice(t-e,1)})}}},watch:{searchColKey:function(){this.searchColList()}},mounted:function(){this.searchColList()}}),M=N,$=Object(h["a"])(M,x,S,!1,null,null,null),O=$.exports,j={name:"DDimModule",components:{DDimDragContainer:k,DBatchAddCol:O},data:function(){return{timeFreqObj:u["m"],timeFreqList:Object.values(u["m"]),dimList:[],hasContrast:!1,contrastDimList:[],configModalVisible:!1,configForm:{timeFreq:"",showName:"",sortType:""},currentConfigCol:{colLabel:"",colConfig:{key:"",showName:"",sortType:""}},activeConfigTab:"",batchAddModalVisible:!1,batchAddTargetType:0}},methods:{addContrast:function(){this.hasContrast=!0},removeContrast:function(){this.hasContrast=!1;var t=!1;this.contrastDimList.length&&(t=!0),this.contrastDimList=[],t&&this.changeDimStore()},openConfig:function(t){this.currentConfigCol=t,this.configForm={timeFreq:t.colConfig.timeFreq,showName:t.colConfig.showName,sortType:t.colConfig.sortType},t.colConfig.timeFreq?this.activeConfigTab="tf":this.activeConfigTab="bs",this.configModalVisible=!0},submitConfigForm:function(){this.currentConfigCol.colConfig.timeFreq=this.configForm.timeFreq,this.currentConfigCol.colConfig.sortType=this.configForm.sortType,this.configForm.showName?this.currentConfigCol.colConfig.showName=this.configForm.showName:this.currentConfigCol.colConfig.showName=this.currentConfigCol.colLabel,this.changeDimStore(),this.configModalVisible=!1},changeDimStore:function(){this.$store.commit("GeneralChart/updateDimConfig",{main:{colList:this.dimList},contrast:{colList:this.contrastDimList}})},openBatchAdd:function(t){this.batchAddModalVisible=!0,this.batchAddTargetType=t},submitBatchAdd:function(t){var e=this;t.forEach(function(t){t.colConfig=w(t),0===e.batchAddTargetType?e.dimList.push(t):e.contrastDimList.push(t)}),this.changeDimStore(),this.batchAddModalVisible=!1}},mounted:function(){}},V=j,A=(i("f3f4"),Object(h["a"])(V,C,g,!1,null,null,null)),q=A.exports,E=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-measure"},[i("div",{staticClass:"d-col-container"},[i("div",{staticClass:"label"},[i("span",[t._v("数值")]),i("i",{staticClass:"fa fa-pencil",attrs:{title:"批量添加"},on:{click:function(e){return t.openBatchAdd(0)}}})]),t.hasSecond?i("div",{staticClass:"axis-type"},[i("el-select",{staticClass:"d-visual-input",attrs:{size:"mini"},on:{change:t.changeMainType},model:{value:t.mainType,callback:function(e){t.mainType=e},expression:"mainType"}},[i("el-option",{attrs:{value:"line",label:"折线"}}),i("el-option",{attrs:{value:"bar",label:"柱状"}})],1)],1):t._e(),i("DMeasureDragContainer",{style:t.dragContainerStyle,on:{change:t.changeMeasureStore,"click-item":t.openConfig},model:{value:t.mainMeasureList,callback:function(e){t.mainMeasureList=e},expression:"mainMeasureList"}}),t.hasSecond?t._e():i("div",{staticClass:"right-btn",on:{click:t.addSecond}},[i("span",[t._v("添加次轴")])])],1),t.hasSecond?i("div",{staticClass:"d-col-container"},[i("div",{staticClass:"label"},[i("span",[t._v("数值")]),i("i",{staticClass:"fa fa-pencil",attrs:{title:"批量添加"},on:{click:function(e){return t.openBatchAdd(1)}}})]),t.hasSecond?i("div",{staticClass:"axis-type"},[i("el-select",{staticClass:"d-visual-input",attrs:{size:"mini"},on:{change:t.changeSecondType},model:{value:t.secondType,callback:function(e){t.secondType=e},expression:"secondType"}},[i("el-option",{attrs:{value:"line",label:"折线"}}),i("el-option",{attrs:{value:"bar",label:"柱状"}})],1)],1):t._e(),i("DMeasureDragContainer",{style:t.dragContainerStyle,on:{change:t.changeMeasureStore,"click-item":t.openConfig},model:{value:t.secondMeasureList,callback:function(e){t.secondMeasureList=e},expression:"secondMeasureList"}}),i("div",{staticClass:"right-btn",on:{click:t.removeSecond}},[i("span",[t._v("移除次轴")])])],1):t._e(),i("el-dialog",{attrs:{visible:t.configModalVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"530px"},on:{"update:visible":function(e){t.configModalVisible=e}}},[i("div",{attrs:{slot:"title"},slot:"title"},[i("span",[i("span",{staticStyle:{color:"#1c2438","font-weight":"700"}},[t._v("指标配置:")]),i("span",{staticStyle:{color:"#be3330"}},[t._v(t._s(t.currentConfigCol.colConfig.showName))]),i("span",{staticStyle:{color:"#1c2438","font-weight":"700","margin-left":"10px"}},[t._v("原始名称:")]),i("span",{staticStyle:{color:"#be3330"}},[t._v(t._s(t.currentConfigCol.colLabel))])])]),i("el-tabs",{model:{value:t.activeConfigTab,callback:function(e){t.activeConfigTab=e},expression:"activeConfigTab"}},[i("el-tab-pane",{attrs:{label:"字段设置",name:"bs"}},[i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("显示名称")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-input",{attrs:{size:"mini",placeholder:t.currentConfigCol.colLabel},model:{value:t.configForm.showName,callback:function(e){t.$set(t.configForm,"showName",e)},expression:"configForm.showName"}})],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("排序方式")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.configForm.sortType,callback:function(e){t.$set(t.configForm,"sortType",e)},expression:"configForm.sortType"}},[i("el-option",{attrs:{value:"0",label:"默认"}}),i("el-option",{attrs:{value:"asc",label:"正序"}}),i("el-option",{attrs:{value:"desc",label:"倒序"}})],1)],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("显示类型")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-radio-group",{model:{value:t.configForm.showType,callback:function(e){t.$set(t.configForm,"showType",e)},expression:"configForm.showType"}},t._l(t.showTypeList,function(e){return i("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("单位")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-input",{attrs:{size:"mini",placeholder:"例如:元,万元,人,个等"},model:{value:t.configForm.unit,callback:function(e){t.$set(t.configForm,"unit",e)},expression:"configForm.unit"}})],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("除数")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-select",{staticStyle:{width:"50%"},attrs:{size:"mini"},model:{value:t.configForm.divisor,callback:function(e){t.$set(t.configForm,"divisor",e)},expression:"configForm.divisor"}},t._l(t.divisorList,function(t){return i("el-option",{key:t.code,attrs:{value:t.code,label:t.name}})}),1),0===t.configForm.divisor?i("el-input-number",{staticStyle:{width:"50%"},attrs:{size:"mini","controls-position":"right",min:1},model:{value:t.configForm.customDivisor,callback:function(e){t.$set(t.configForm,"customDivisor",e)},expression:"configForm.customDivisor"}}):t._e()],1)])],1),t.currentConfigCol.isNewCol?t._e():i("el-tab-pane",{attrs:{label:"函数",name:"func"}},[i("el-radio-group",{model:{value:t.configForm.aggFunction,callback:function(e){t.$set(t.configForm,"aggFunction",e)},expression:"configForm.aggFunction"}},t._l(t.aggFuncList,function(e){return i("div",{key:e.code,staticClass:"vertical"},[i("el-radio",{attrs:{label:e.code}},[t._v(t._s(e.name))])],1)}),0)],1),i("el-tab-pane",{attrs:{label:"同环比",name:"thb"}},[i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"所选日期字段必须出现在图内筛选、默认过滤器或者维度列中",placement:"top"}},[i("i",{staticClass:"el-icon-info"})]),i("span",[t._v("日期字段")])],1),i("div",{staticClass:"measure-bs-form-input"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.configForm.THBTimeCol,callback:function(e){t.$set(t.configForm,"THBTimeCol",e)},expression:"configForm.THBTimeCol"}},t._l(t.dateColList,function(t){return i("el-option",{key:t.colName,attrs:{value:t.colName,label:t.colLabel}})}),1)],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("对比类型")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-checkbox-group",{model:{value:t.configForm.THB,callback:function(e){t.$set(t.configForm,"THB",e)},expression:"configForm.THB"}},t._l(t.THBList,function(e,o){return i("el-checkbox",{key:o,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1)]),i("el-row",{staticClass:"d-row d-form-item"},[i("div",{staticClass:"measure-bs-form-label"},[i("span",[t._v("数值设置")])]),i("div",{staticClass:"measure-bs-form-input"},[i("el-radio-group",{model:{value:t.configForm.THBValueType,callback:function(e){t.$set(t.configForm,"THBValueType",e)},expression:"configForm.THBValueType"}},t._l(t.THBValueTypeList,function(e){return i("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1)])],1)],1),i("DSubmitCancel",{attrs:{slot:"footer",nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submitConfigForm,cancel:function(e){t.configModalVisible=!1}},slot:"footer"})],1),i("el-dialog",{attrs:{title:"批量添加指标字段",visible:t.batchAddModalVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"600px"},on:{"update:visible":function(e){t.batchAddModalVisible=e}}},[i("DBatchAddCol",{on:{submit:t.submitBatchAdd,cancel:function(e){t.batchAddModalVisible=!1}}})],1)],1)},B=[],I=(i("456d"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("DDraggableContainer",{staticClass:"d-drag-container",attrs:{horizontal:"",disabled:"",noDataText:"从左侧字段列表拖拽字段到这里"},on:{drop:t.dragDropCol},scopedSlots:t._u([{key:"default",fn:function(e){var o=e.item,n=e.index;return[o?i("div",{staticClass:"tag-item"},[i("div",{on:{click:function(e){return t.openConfig(o)}}},[i("span",[t._v(t._s(o.colConfig.showName))]),i("span",[t._v("("+t._s(o.isNewCol?"计算字段":t.aggFuncObj[o.colConfig.aggFunction].name)+")")])]),i("div",{staticClass:"btn"},[i("i",{staticClass:"fa fa-times-circle",attrs:{title:"移除字段"},on:{click:function(e){return t.removeCol(n)}}})])]):t._e()]}}]),model:{value:t.measureList,callback:function(e){t.measureList=e},expression:"measureList"}})}),P=[],z={name:"DMeasureDragContainer",props:{value:{type:Array,default:function(){return[]}}},data:function(){return{measureList:this.value,aggFuncObj:u["a"]}},watch:{value:function(){this.measureList=this.value}},methods:{openConfig:function(t){this.$emit("click-item",t)},removeCol:function(t){this.measureList.splice(t,1),this.$emit("change",this.measureList)},allowDrop:function(t){t.preventDefault()},dragDropCol:function(t){var e=this.getDragingCol(t);this.measureList.push(e),this.$emit("change",this.measureList)},getDragingCol:function(t){var e=t.dataTransfer.getData("dragingCol");return e=JSON.parse(e),e.colConfig=y(e),e}}},H=z,K=Object(h["a"])(H,I,P,!1,null,null,null),W=K.exports,J={name:"DMeasureModule",components:{DMeasureDragContainer:W,DBatchAddCol:O},data:function(){return{aggFuncList:Object.values(u["a"]),aggFuncObj:u["a"],showTypeList:Object.values(u["i"]),THBList:Object.values(u["k"]),THBValueTypeList:Object.values(u["l"]),mainMeasureList:[],mainType:"line",hasSecond:!1,secondMeasureList:[],secondType:"bar",configModalVisible:!1,configForm:{aggFunction:"",showName:"",sortType:"",unit:"",divisor:1,customDivisor:1,THB:[],THBValueType:"",THBTimeCol:""},currentConfigCol:{colLabel:"",colConfig:{key:"",showName:"",sortType:""}},activeConfigTab:"",batchAddModalVisible:!1,batchAddTargetType:0,divisorList:[{code:1,name:"空"},{code:100,name:"百"},{code:1e3,name:"千"},{code:1e4,name:"万"},{code:1e6,name:"百万"},{code:0,name:"自定义"}],dateColList:[]}},computed:{dragContainerStyle:function(){return this.hasSecond?{width:"calc(100% - 188px)"}:{}}},methods:{addSecond:function(){this.hasSecond=!0},removeSecond:function(){this.hasSecond=!1;var t=!1;this.secondMeasureList.length&&(t=!0),this.secondMeasureList=[],t&&this.changeMeasureStore()},openConfig:function(t){this.currentConfigCol=t,this.configForm={aggFunction:t.colConfig.aggFunction,showName:t.colConfig.showName,sortType:t.colConfig.sortType,showType:t.colConfig.showType,unit:t.colConfig.unit,divisor:t.colConfig.divisor,customDivisor:t.colConfig.customDivisor,THB:t.colConfig.THB,THBValueType:t.colConfig.THBValueType,THBTimeCol:t.colConfig.THBTimeCol},this.activeConfigTab="bs",this.dateColList=this.$store.state.GeneralChart.workTableColList.filter(function(t){return t.dataType!==c["b"].num.code&&t.dataType!==c["b"].text.code&&!t.isNewCol}).map(function(t){return JSON.parse(JSON.stringify(t))}),this.configModalVisible=!0},submitConfigForm:function(){var t=this;Object.keys(this.configForm).forEach(function(e){t.currentConfigCol.colConfig[e]=t.configForm[e]}),this.configForm.showName||(this.currentConfigCol.colConfig.showName=this.currentConfigCol.colLabel),this.changeMeasureStore(),this.configModalVisible=!1},changeMeasureStore:function(){this.$store.commit("GeneralChart/updateMeasureConfig",{main:{type:this.mainType,colList:this.mainMeasureList},second:{type:this.secondType,colList:this.secondMeasureList}})},openBatchAdd:function(t){this.batchAddModalVisible=!0,this.batchAddTargetType=t},submitBatchAdd:function(t){var e=this;t.forEach(function(t){t.colConfig=y(t),0===e.batchAddTargetType?e.mainMeasureList.push(t):e.secondMeasureList.push(t)}),this.changeMeasureStore(),this.batchAddModalVisible=!1},changeMainType:function(){this.mainMeasureList.length&&this.changeMeasureStore()},changeSecondType:function(){this.secondMeasureList.length&&this.changeMeasureStore()}},mounted:function(){}},G=J,U=(i("100b"),Object(h["a"])(G,E,B,!1,null,null,null)),Q=U.exports,R=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-default-filter"},[i("div",{staticClass:"label"},[t._v("过滤器")]),i("ul",{staticClass:"filter-list",on:{dragover:function(e){return t.allowDrop(e)},drop:function(e){return t.dragDropCol(e)}}},[t._l(t.filterList,function(e,o){return i("li",{key:o,staticClass:"filter-item"},[i("div",{staticClass:"filter-item-head"},[i("div",{staticClass:"angle-icon",on:{click:function(i){return t.toggleShowCondition(e)}}},[i("i",{directives:[{name:"show",rawName:"v-show",value:e.colConfig.showCondition,expression:"item.colConfig.showCondition"}],staticClass:"fa fa-angle-down"}),i("i",{directives:[{name:"show",rawName:"v-show",value:!e.colConfig.showCondition,expression:"!item.colConfig.showCondition"}],staticClass:"fa fa-angle-right"})]),i("div",{staticClass:"filter-name d-ellipsis",attrs:{title:e.colLabel},on:{click:function(i){return t.toggleShowCondition(e)}}},[t._v("\n                    "+t._s(e.colLabel)+"\n                ")]),i("div",{staticClass:"oper-btn"},[i("i",{staticClass:"fa fa-pencil",attrs:{title:"编辑配置"},on:{click:function(i){return t.openConfig(e)}}}),i("i",{staticClass:"fa fa-times-circle",attrs:{title:"移除字段"},on:{click:function(e){return t.removeCol(o)}}})])]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.colConfig.showCondition,expression:"item.colConfig.showCondition"}],staticClass:"filter-condition-list"},["condition"===e.colConfig.filterPanelType?i("div",[i("div",[t._v(t._s(t.conditionSpliceTypeObj[e.colConfig.conditionSpliceType].name))]),i("ul",t._l(e.colConfig.conditionList,function(e,o){return i("li",{key:o,staticClass:"condition-item"},[i("div",{staticClass:"oper-label"},[t._v("\n                                "+t._s(t.operatorObj[e.oper].name)+"\n                            ")]),i("div",{staticClass:"oper-value"},[t._v("\n                                "+t._s(e.value)+"\n                            ")])])}),0)]):"accurate"===e.colConfig.filterPanelType?i("div",[i("div",[t._v(t._s(t.operatorObj[e.colConfig.oper].name))]),i("ul",t._l(e.colConfig.value.split(","),function(e){return i("li",{key:e,staticClass:"d-ellipsis"},[t._v("\n                            "+t._s(e)+"\n                        ")])}),0)]):"time"===e.colConfig.filterPanelType?i("div",[t._v("\n                    "+t._s(e.colConfig.relativeTimeLabel)+"\n                ")]):t._e()])])}),t.filterList.length?t._e():i("li",{staticClass:"d-no-data-tip"},[t._v("\n            从左侧字段列表拖拽字段到这里\n        ")]),i("li",{staticStyle:{height:"28px"}})],2),i("el-dialog",{attrs:{title:"配置过滤器条件",visible:t.configModalVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"600px"},on:{"update:visible":function(e){t.configModalVisible=e}}},[i("el-row",{staticClass:"d-row"},[i("el-radio-group",{model:{value:t.filterPanelType,callback:function(e){t.filterPanelType=e},expression:"filterPanelType"}},t._l(t.filterPanelTypeList,function(e){return i("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1),i("el-row",{staticClass:"default-filter-form"},["time"===t.filterPanelType?i("DTimeFilterConfigForm",{attrs:{col:t.currentConfigCol},on:{submit:t.submitConfigForm,cancel:function(e){t.configModalVisible=!1}}}):t._e(),"accurate"===t.filterPanelType?i("DAccurateFilterConfigForm",{attrs:{col:t.currentConfigCol},on:{submit:t.submitConfigForm,cancel:function(e){t.configModalVisible=!1}}}):t._e(),"condition"===t.filterPanelType?i("DConditionFilterConfigForm",{attrs:{col:t.currentConfigCol},on:{submit:t.submitConfigForm,cancel:function(e){t.configModalVisible=!1}}}):t._e()],1)],1)],1)},X=[],Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"time-filter-config"},[i("el-row",{staticClass:"d-row"},[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"label"},[t._v("\n                时间粒度\n            ")]),i("div",{staticClass:"value d-box-middle"},[i("el-radio-group",{on:{change:t.changeTimeFreq},model:{value:t.configForm.timeFreq,callback:function(e){t.$set(t.configForm,"timeFreq",e)},expression:"configForm.timeFreq"}},t._l(t.timeFreqList,function(e){return i("div",{key:e,staticClass:"vertical"},[i("el-radio",{attrs:{label:e}},[t._v(t._s(t.timeFreqObj[e].name))])],1)}),0)],1)]),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"label"},[t._v("条件值")]),i("div",{staticClass:"value d-box-middle"},[i("el-radio-group",{model:{value:t.configForm.relativeTimeNum,callback:function(e){t.$set(t.configForm,"relativeTimeNum",e)},expression:"configForm.relativeTimeNum"}},t._l(t.relativeTimeList,function(e){return i("div",{key:e.dateNum,staticClass:"vertical"},[i("el-radio",{attrs:{label:e.dateNum}},[t._v(t._s(e.name))])],1)}),0)],1)])],1),i("el-row",{staticClass:"d-row"},[i("DSubmitCancel",{attrs:{nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submit,cancel:t.cancel}})],1)],1)},Z=[],tt=(i("7f7f"),{name:"DTimeFilterConfigForm",props:{col:Object},data:function(){return{timeFreqObj:u["m"],timeFreqList:[],relativeTimeList:[],configForm:{timeFreq:"",relativeTimeNum:-1,relativeTimeLabel:""}}},methods:{initForm:function(){this.configForm.timeFreq=this.col.colConfig.timeFreq,this.timeFreqList=c["b"][this.col.dataType].timeFreq,this.relativeTimeList=u["m"][this.configForm.timeFreq].range,this.configForm.relativeTimeNum=this.col.colConfig.relativeTimeNum},submit:function(){var t=this;this.configForm.relativeTimeLabel=this.relativeTimeList.filter(function(e){return e.dateNum===t.configForm.relativeTimeNum})[0].name,this.$emit("submit",this.configForm)},cancel:function(){this.$emit("cancel")},changeTimeFreq:function(){this.relativeTimeList=u["m"][this.configForm.timeFreq].range,this.configForm.relativeTimeNum=u["m"][this.configForm.timeFreq].rangeDefaultDateNum}},mounted:function(){this.initForm()}}),et=tt,it=(i("5c04"),Object(h["a"])(et,Y,Z,!1,null,null,null)),ot=it.exports,nt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"accurate-filter-config"},[i("el-row",{staticClass:"d-row d-transfer-head"},[i("div",{staticClass:"d-transfer-head-panel"},[i("el-input",{attrs:{size:"mini",clearable:"",placeholder:"搜索"+t.col.colLabel,"suffix-icon":"el-icon-search"},model:{value:t.keyword,callback:function(e){t.keyword="string"===typeof e?e.trim():e},expression:"keyword"}})],1),i("div",{staticClass:"d-transfer-center"}),i("div",{staticClass:"d-transfer-head-panel"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.configForm.oper,callback:function(e){t.$set(t.configForm,"oper",e)},expression:"configForm.oper"}},t._l(t.operList,function(t){return i("el-option",{key:t.code,attrs:{value:t.code,label:t.name}})}),1)],1)]),i("el-row",{staticClass:"d-row"},[i("el-transfer",{staticClass:"d-transfer",attrs:{titles:["可选项","已选项"],data:t.transferData},model:{value:t.transferValue,callback:function(e){t.transferValue=e},expression:"transferValue"}})],1),i("el-row",{staticClass:"d-row"},[i("DSubmitCancel",{attrs:{nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submit,cancel:t.cancel}})],1)],1)},at=[],st=(i("28a5"),i("1379")),lt={name:"DAccurateFilterConfigForm",props:{col:Object},data:function(){return{operList:[u["h"].in,u["h"].notin],configForm:{oper:u["h"].in.code,value:""},transferValue:[],transferData:[],keyword:"",allData:[],loading:!1,maxSize:50}},methods:{initData:function(){this.col.colConfig.value&&(this.transferValue=this.col.colConfig.value.split(",")),this.col.colConfig.oper&&(this.configForm.oper=this.col.colConfig.oper),this.setAllData()},setAllData:function(){var t=this;this.loading=!0,Object(st["b"])({tbId:this.$store.state.GeneralChart.editConfig.workTable.tbId,tbName:this.$store.state.GeneralChart.editConfig.workTable.tbName,dbName:this.$store.state.GeneralChart.editConfig.workTable.dbName,colName:this.col.colName}).then(function(e){t.loading=!1,t.allData=e.data,t.searchTransferData()}).catch(function(e){t.$handleError(e),t.loading=!1})},searchTransferData:function(){var t=this,e=[];e=this.keyword?this.allData.filter(function(e){return e.includes(t.keyword)}):this.allData,e.length>this.maxSize&&(e=e.slice(0,this.maxSize)),this.transferValue.forEach(function(t){e.includes(t)||e.push(t)}),this.transferData=e.map(function(t){return{key:t,label:t}})},submit:function(){this.transferValue.length?(this.configForm.value=this.transferValue.join(","),this.$emit("submit",this.configForm)):this.$messageWarn("未选择任何选项!")},cancel:function(){this.$emit("cancel")}},watch:{keyword:function(){this.searchTransferData()}},mounted:function(){this.initData()}},ct=lt,rt=(i("1825"),Object(h["a"])(ct,nt,at,!1,null,null,null)),dt=rt.exports,ut=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"conditioin-filter-config"},[i("el-row",{staticClass:"d-row"},[i("el-select",{attrs:{size:"mini"},model:{value:t.configForm.conditionSpliceType,callback:function(e){t.$set(t.configForm,"conditionSpliceType",e)},expression:"configForm.conditionSpliceType"}},t._l(t.conditionSpliceTypeList,function(t){return i("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}),1)],1),i("el-row",{staticClass:"d-row condition-row"},[i("el-col",{attrs:{span:3}},[t._v("\n            "+t._s(t.col.colLabel)+"\n        ")]),i("el-col",{attrs:{span:6}},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini",placeholder:"请选择条件"},model:{value:t.conditionForm.oper,callback:function(e){t.$set(t.conditionForm,"oper",e)},expression:"conditionForm.oper"}},t._l(t.operatorList,function(t){return i("el-option",{key:t.code,attrs:{label:t.name,value:t.code}})}),1)],1),i("el-col",{attrs:{span:13}},[i("el-input",{style:t.conditionInputStyle,attrs:{size:"mini",clearable:"",disabled:"empty"===t.conditionForm.oper||"unempty"===t.conditionForm.oper,placeholder:"请输入条件"},model:{value:t.conditionForm.value,callback:function(e){t.$set(t.conditionForm,"value","string"===typeof e?e.trim():e)},expression:"conditionForm.value"}}),"between"===t.conditionForm.oper||"unbetween"===t.conditionForm.oper?i("span",[t._v("~")]):t._e(),"between"===t.conditionForm.oper||"unbetween"===t.conditionForm.oper?i("el-input",{style:t.conditionInputStyle,attrs:{size:"mini",clearable:"",placeholder:"请输入条件"},model:{value:t.conditionForm.value2,callback:function(e){t.$set(t.conditionForm,"value2","string"===typeof e?e.trim():e)},expression:"conditionForm.value2"}}):t._e()],1),i("el-col",{staticClass:"condition-btn",attrs:{span:2},nativeOn:{click:function(e){return t.addCondition(e)}}},[i("i",{staticClass:"fa fa-plus",attrs:{title:"新增条件"}})])],1),t._l(t.configForm.conditionList,function(e,o){return i("el-row",{key:o,staticClass:"d-row condition-row"},[i("el-col",{attrs:{span:3}},[t._v("\n            "+t._s(t.col.colLabel)+"\n        ")]),i("el-col",{attrs:{span:6}},[t._v("\n            "+t._s(t.operatorObj[e.oper].name)+"\n        ")]),i("el-col",{attrs:{span:13}},[i("span",[t._v(" "+t._s(e.value))])]),i("el-col",{staticClass:"condition-btn",attrs:{span:2},nativeOn:{click:function(e){return t.removeCondition(o)}}},[i("i",{staticClass:"fa fa-minus",attrs:{title:"删除条件"}})])],1)}),i("el-row",{staticClass:"d-row"},[i("DSubmitCancel",{attrs:{nohr:"",size:"mini",submitText:"确定"},on:{submit:t.submit,cancel:t.cancel}})],1)],2)},ft=[],mt={name:"DAccurateFilterConfigForm",props:{col:Object},data:function(){return{operatorObj:u["h"],operatorList:Object.values(u["h"]).filter(function(t){return"in"!==t.code&&"notin"!==t.code}),conditionSpliceTypeList:Object.values(u["c"]),configForm:{conditionSpliceType:u["c"].and.code,conditionList:[]},conditionForm:{oper:"",value:"",value2:""}}},computed:{conditionInputStyle:function(){return"between"===this.conditionForm.oper||"unbetween"===this.conditionForm.oper?{width:"calc(50% - 4px)"}:{width:"100%"}}},methods:{initData:function(){this.configForm={conditionSpliceType:this.col.colConfig.conditionSpliceType?this.col.colConfig.conditionSpliceType:u["c"].and.code,conditionList:this.col.colConfig.conditionList?this.col.colConfig.conditionList:[]},this.initConditionForm()},initConditionForm:function(){this.conditionForm={oper:"",value:"",value2:""}},addCondition:function(){var t=this.getCondition(!0);t&&(this.configForm.conditionList.push(t),this.initConditionForm())},getCondition:function(t){if(this.conditionForm.oper){var e=this.conditionForm.value;if(this.conditionForm.oper===u["h"].empty.code||this.conditionForm.oper===u["h"].unempty.code)e="";else if(this.conditionForm.oper===u["h"].between.code||this.conditionForm.oper===u["h"].unbetween.code){if(void 0===e||""===e||void 0===this.conditionForm.value2||""===this.conditionForm.value2)return void(t&&this.$messageWarn("请输入完整区间条件"));e=e+","+this.conditionForm.value2}else if(void 0===e||""===e)return void(t&&this.$messageWarn("请输入条件"));return{oper:this.conditionForm.oper,value:e}}t&&this.$messageWarn("请选择条件")},removeCondition:function(t){this.configForm.conditionList.splice(t,1)},submit:function(){var t=this.getCondition(!1);t&&this.configForm.conditionList.push(t),this.configForm.conditionList.length?(this.initConditionForm(),this.$emit("submit",this.configForm)):this.$messageWarn("请至少添加一下筛选条件")},cancel:function(){this.$emit("cancel")}},mounted:function(){this.initData()}},ht=mt,pt=(i("6264"),Object(h["a"])(ht,ut,ft,!1,null,null,null)),bt=pt.exports,Ct={name:"DDefaultFilterModule",components:{DTimeFilterConfigForm:ot,DAccurateFilterConfigForm:dt,DConditionFilterConfigForm:bt},data:function(){return{operatorObj:u["h"],conditionSpliceTypeObj:u["c"],filterList:[],currentConfigCol:null,filterPanelTypeList:[],filterPanelType:"",configModalVisible:!1,isAdd:!0}},methods:{allowDrop:function(t){t.preventDefault()},setFilterPanelTypeList:function(){this.currentConfigCol.dataType===c["b"].text.code?this.filterPanelTypeList=[u["e"].accurate,u["e"].condition]:this.currentConfigCol.dataType===c["b"].num.code?this.filterPanelTypeList=[u["e"].condition]:this.filterPanelTypeList=[u["e"].time]},dragDropCol:function(t){var e=t.dataTransfer.getData("dragingCol");if(e=JSON.parse(e),e.isNewCol)this.$messageWarn("计算字段不可添加!");else{var i=this.filterList.findIndex(function(t){return t.colName===e.colName});i>-1?this.$messageWarn("此字段已添加!"):(e.colConfig=F(e),this.currentConfigCol=e,this.setFilterPanelTypeList(),this.filterPanelType=e.colConfig.filterPanelType,this.isAdd=!0,this.configModalVisible=!0)}},openConfig:function(t){this.isAdd=!1,this.currentConfigCol=t,this.setFilterPanelTypeList(),this.configModalVisible=!0},submitConfigForm:function(t){this.currentConfigCol.colConfig=JSON.parse(JSON.stringify(t)),this.currentConfigCol.colConfig.filterPanelType=this.filterPanelType,this.currentConfigCol.colConfig.showCondition=!0,this.isAdd&&this.filterList.push(this.currentConfigCol),this.changeDefaultFilterStore(),this.configModalVisible=!1},removeCol:function(t){this.filterList.splice(t,1),this.changeDefaultFilterStore()},changeDefaultFilterStore:function(){this.$store.commit("GeneralChart/updateDefaultFilterMeta",JSON.parse(JSON.stringify(this.filterList)))},toggleShowCondition:function(t){t.colConfig.showCondition=!t.colConfig.showCondition,this.$forceUpdate()}}},gt=Ct,vt=(i("a64f"),Object(h["a"])(gt,R,X,!1,null,null,null)),Tt=vt.exports,wt=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},yt=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-preview"},[i("div",{staticClass:"d-chart-container"})])}],Ft={name:"DChartPreviewModule"},_t=Ft,Lt=(i("abdb"),Object(h["a"])(_t,wt,yt,!1,null,null,null)),Dt=Lt.exports,kt={name:"DChartDesign",components:{DWorkTable:b,DDimModule:q,DMeasureModule:Q,DDefaultFilterModule:Tt,DChartPreviewModule:Dt},data:function(){return{tbId:""}},methods:{submit:function(){},cancel:function(){this.$goBack()}},mounted:function(){this.tbId=this.$route.query.tbId}},xt=kt,St=(i("e225"),Object(h["a"])(xt,o,n,!1,null,null,null));e["default"]=St.exports},1825:function(t,e,i){"use strict";var o=i("2022"),n=i.n(o);n.a},2022:function(t,e,i){},2625:function(t,e,i){},"42bb":function(t,e,i){"use strict";var o=i("49fe"),n=i.n(o);n.a},"49fe":function(t,e,i){},"5c04":function(t,e,i){"use strict";var o=i("2625"),n=i.n(o);n.a},6264:function(t,e,i){"use strict";var o=i("9ff2"),n=i.n(o);n.a},"75ff":function(t,e,i){},"90f3":function(t,e,i){},"9ff2":function(t,e,i){},a64f:function(t,e,i){"use strict";var o=i("af45"),n=i.n(o);n.a},abdb:function(t,e,i){"use strict";var o=i("90f3"),n=i.n(o);n.a},af45:function(t,e,i){},c82b:function(t,e,i){"use strict";var o=i("f338"),n=i.n(o);n.a},d45b:function(t,e,i){"use strict";var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-row",{staticClass:"d-row"},[t._v("\n        选择工作表\n    ")]),i("el-row",{staticClass:"d-row"},[i("el-input",{attrs:{size:"mini",clearable:"",placeholder:"搜索工作表","suffix-icon":"el-icon-search"},on:{change:t.searchTable},model:{value:t.tableKeyWord,callback:function(e){t.tableKeyWord="string"===typeof e?e.trim():e},expression:"tableKeyWord"}})],1),i("el-row",{staticClass:"d-row"},[i("div",{staticClass:"d-tb-panel"},[i("ul",{staticClass:"d-tb-list"},t._l(t.searchedTableList,function(e,o){return i("li",{key:o,staticClass:"d-tb-item",on:{click:function(i){return t.selectTable(e)}}},[i("h4",{staticClass:"d-tb-title d-ellipsis",attrs:{title:e.dbName+"."+e.tbName}},[t._v(t._s(e.dbName)+"."+t._s(e.tbName))]),i("div",{staticClass:"d-tb-desc d-ellipsis",attrs:{title:e.tbNameCn}},[t._v(t._s(e.tbNameCn))])])}),0)])])],1)},n=[],a=i("8a52"),s={name:"DWorkTableSelect",data:function(){return{tableKeyWord:"",searchedTableList:[]}},methods:{searchTable:function(){var t=this;Object(a["f"])({tbName:this.tableKeyWord,pageNo:1,pageSize:15}).then(function(e){t.searchedTableList=e.data.data}).catch(this.$handleError)},selectTable:function(t){this.$emit("select",t)}},mounted:function(){this.searchTable()}},l=s,c=(i("42bb"),i("2877")),r=Object(c["a"])(l,o,n,!1,null,null,null);e["a"]=r.exports},e1b6:function(t,e,i){},e225:function(t,e,i){"use strict";var o=i("03fb"),n=i.n(o);n.a},f338:function(t,e,i){},f3f4:function(t,e,i){"use strict";var o=i("e1b6"),n=i.n(o);n.a}}]);
//# sourceMappingURL=chunk-03531b42.90791df0.js.map