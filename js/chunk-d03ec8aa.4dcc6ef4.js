(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d03ec8aa"],{"0a37":function(e,t,s){"use strict";var r=s("218f"),a=s.n(r);a.a},"218f":function(e,t,s){},6073:function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("DPageContent",[s("el-card",{attrs:{shadow:"never"}},[s("el-row",{staticClass:"d-row"},[s("div",{staticClass:"d-search-form",staticStyle:{float:"left"}},[s("el-select",{attrs:{size:"small",clearable:"",placeholder:"类型"},on:{change:e.setTableData},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},e._l(e.dbTypeList,function(e){return s("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1),s("el-input",{staticClass:"item",attrs:{size:"small",placeholder:"数据源名称/数据库名称","suffix-icon":"el-icon-search",clearable:""},on:{change:e.setTableData},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),s("div",{staticStyle:{float:"right"}},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.openAddDsForm()}}},[e._v("新增数据源")])],1)]),s("el-row",{staticClass:"d-row"},[s("el-table",{attrs:{data:e.tableData.data,"row-key":"id","default-expand-all":"","row-class-name":e.tableRowClassName}},[s("el-table-column",{attrs:{prop:"name",label:"数据源名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("router-link",{attrs:{to:"/data-map/ds-manage/"+t.row.id}},[e._v(e._s(t.row.name))])]}}])}),s("el-table-column",{attrs:{prop:"type",label:"类型",width:"150"}}),s("el-table-column",{attrs:{prop:"host",label:"域名",width:"200"}}),s("el-table-column",{attrs:{prop:"dbName",label:"数据库名称",width:"200"}}),s("el-table-column",{attrs:{prop:"remark",label:"描述"}}),s("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){return e.openUpdateDsForm(t.row)}}},[e._v("编辑")]),s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){return e.deleteDsById(t.row)}}},[e._v("删除")]),1===t.row.isBaseDs?s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){return e.openAddDsForm(t.row)}}},[e._v("新建查询引擎")]):e._e(),1===t.row.isBaseDs?s("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(s){return e.openDsOwnerForm(t.row)}}},[e._v("变更Owner")]):e._e()]}}])})],1)],1),s("el-row",{staticClass:"d-right-pagination"},[s("el-pagination",{attrs:{background:"","current-page":e.pageNo,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next",total:e.tableData.total},on:{"current-change":e.setTableData,"size-change":e.setTableData,"update:currentPage":function(t){e.pageNo=t},"update:current-page":function(t){e.pageNo=t},"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t}}})],1)],1),s("el-dialog",{attrs:{title:e.dsFormTitle,top:"30px",visible:e.dsFormVisible},on:{"update:visible":function(t){e.dsFormVisible=t}}},[s("el-form",{ref:"dsForm",attrs:{model:e.dsForm,rules:e.formRules,"label-width":"100px"}},[s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"类型",prop:"type"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{disabled:void 0!=e.dsForm.id},model:{value:e.dsForm.type,callback:function(t){e.$set(e.dsForm,"type",t)},expression:"dsForm.type"}},e._l(e.dbTypeList,function(e){return s("el-option",{key:e.code,attrs:{label:e.name,value:e.code}})}),1)],1)],1),s("el-col",{attrs:{span:12}})],1),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"数据源名称",prop:"name"}},[s("el-input",{model:{value:e.dsForm.name,callback:function(t){e.$set(e.dsForm,"name",t)},expression:"dsForm.name"}})],1)],1),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"描述",prop:"remark"}},[s("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.dsForm.remark,callback:function(t){e.$set(e.dsForm,"remark",t)},expression:"dsForm.remark"}})],1)],1)],1),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"域名",prop:"host"}},[s("el-input",{model:{value:e.dsForm.host,callback:function(t){e.$set(e.dsForm,"host",t)},expression:"dsForm.host"}})],1)],1),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"端口",prop:"port"}},[s("el-input",{model:{value:e.dsForm.port,callback:function(t){e.$set(e.dsForm,"port",t)},expression:"dsForm.port"}})],1)],1)],1),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"数据库名称",prop:"dbName"}},[s("el-input",{attrs:{disabled:void 0!=e.dsForm.id},model:{value:e.dsForm.dbName,callback:function(t){e.$set(e.dsForm,"dbName",t)},expression:"dsForm.dbName"}})],1)],1),s("el-col",{attrs:{span:12}})],1),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"用户名",prop:"userName"}},[s("el-input",{model:{value:e.dsForm.userName,callback:function(t){e.$set(e.dsForm,"userName",t)},expression:"dsForm.userName"}})],1)],1),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"密码",prop:"password"}},[s("el-input",{attrs:{type:"password"},model:{value:e.dsForm.password,callback:function(t){e.$set(e.dsForm,"password",t)},expression:"dsForm.password"}})],1)],1)],1),s("el-row",[s("el-col",{attrs:{span:12}},[0===e.dsForm.isBaseDs?s("el-form-item",{attrs:{label:"优先级",prop:"priority"}},[s("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:100},model:{value:e.dsForm.priority,callback:function(t){e.$set(e.dsForm,"priority",t)},expression:"dsForm.priority"}})],1):e._e()],1),s("el-col",{attrs:{span:12}},[0===e.dsForm.isBaseDs?s("el-form-item",{attrs:{label:"元数据同步",prop:"isAutoMeta"}},[s("el-radio-group",{model:{value:e.dsForm.isAutoMeta,callback:function(t){e.$set(e.dsForm,"isAutoMeta",t)},expression:"dsForm.isAutoMeta"}},[s("el-radio",{attrs:{label:1}},[e._v("自动")]),s("el-radio",{attrs:{label:0}},[e._v("手动")])],1)],1):e._e()],1)],1)],1),s("DSubmitCancel",{attrs:{slot:"footer",nohr:""},on:{submit:e.submitDsForm,cancel:function(t){e.dsFormVisible=!1}},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.testDs}},[e._v("测试连接")])],1)],1),s("el-dialog",{attrs:{title:"变更Owner："+e.currentDs.name,visible:e.dsOwnerFormVisible},on:{"update:visible":function(t){e.dsOwnerFormVisible=t}}},[s("el-row",{staticStyle:{"margin-bottom":"20px"}},[s("el-select",{staticStyle:{float:"right",width:"220px"},attrs:{filterable:"","reserve-keyword":"",multiple:"",remote:"",placeholder:"请输入用户名或姓名,搜索添加",size:"small","remote-method":e.searchUser},on:{change:e.selectUser},model:{value:e.userNameList,callback:function(t){e.userNameList=t},expression:"userNameList"}},e._l(e.searchUserList,function(t,r){return s("el-option",{key:t.userName,attrs:{label:t.userNameCn,value:t.userName}},[s("span",{staticStyle:{float:"left"}},[e._v(e._s(t.userNameCn)+"("+e._s(t.userName)+")")]),s("span",{staticStyle:{float:"right"}},[s("el-button",{attrs:{type:"text",title:"添加用户",icon:"el-icon-plus"},on:{click:function(s){return e.addDsOwner(t,r)}}})],1)])}),1)],1),s("el-row",e._l(e.dsOwnerList,function(t,r){return s("el-col",{key:t.id,staticClass:"d-hover-btn",attrs:{span:6}},[s("span",[e._v(e._s(t.ownerNameCn)+"("+e._s(t.ownerName)+")")]),s("el-button",{attrs:{type:"text",title:"删除用户",icon:"el-icon-delete"},on:{click:function(s){return e.deleteDsOwnerById(t.id,r)}}})],1)}),1)],1)],1)},a=[],o=(s("20d6"),s("7f7f"),s("ac6a"),s("8615"),s("f4b2")),i=s("f958"),n={name:"DDsManager",data:function(){return{searchForm:{type:"",name:""},pageSize:10,pageNo:1,tableData:{total:0,data:[]},dbTypeList:Object.values(o["b"]),dsFormVisible:!1,dsFormTitle:"新建数据源",dsForm:{type:o["b"].MYSQL.code,name:"",host:"",port:"",dbName:"",userName:"",password:"",isBaseDs:1,priority:0},formRules:{type:[{required:!0,message:"请选择类型",trigger:"change"}],name:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],host:[{required:!0,message:"请输入域名",trigger:"blur"}],dbName:[{required:!0,message:"请输入数据库名称",trigger:"blur"},{type:"string",pattern:/^[A-Za-z]+[A-Za-z0-9_]*[A-Za-z0-9]+$/,message:"只能包含数字、字母、下划线,字母开头",trigger:"blur"}],userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{type:"string",pattern:/^[A-Za-z]+[A-Za-z0-9_]*[A-Za-z0-9]+$/,message:"只能包含数字、字母、下划线,字母开头",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],port:[{type:"string",pattern:/^[1-9]+[0-9]*$/,message:"端口号只能是数字",trigger:"blur"}]},currentDs:{},dsOwnerFormVisible:!1,dsOwnerList:[],searchUserList:[],userNameList:[]}},methods:{setTableData:function(){var e=this;Object(o["h"])({pageSize:this.pageSize,pageNo:this.pageNo,type:this.searchForm.type,name:this.searchForm.name}).then(function(t){e.tableData=t.data}).catch(this.$handleError)},openAddDsForm:function(e){this.dsFormVisible=!0,this.dsForm={type:o["b"].MYSQL.code,name:"",host:"",port:"",dbName:"",userName:"",password:"",priority:1,isAutoMeta:1},e?(this.dsFormTitle="新建数据源："+e.name+" 的查询引擎",this.dsForm.isBaseDs=0,this.dsForm.baseDsId=e.id):(this.dsFormTitle="新建数据源",this.dsForm.isBaseDs=1,this.dsForm.baseDsId=0)},openUpdateDsForm:function(e){this.dsFormVisible=!0,1===e.isBaseDs?this.dsFormTitle="编辑数据源":this.dsFormTitle="编辑查询引擎",this.dsForm={id:e.id,type:e.type,name:e.name,remark:e.remark,host:e.host,port:e.port,dbName:e.dbName,userName:e.userName,password:e.password,isBaseDs:e.isBaseDs,baseDsId:e.baseDsId,priority:e.priority,isAutoMeta:e.isAutoMeta}},submitDsForm:function(){var e=this;this.$refs["dsForm"].validate(function(t){if(!t)return!1;Object(o["d"])(e.dsForm).then(function(t){e.dsFormVisible=!1,e.setTableData()}).catch(e.$handleError)})},testDs:function(){var e=this;this.$refs["dsForm"].validate(function(t){if(!t)return!1;Object(o["j"])(e.dsForm).then(function(t){e.$messageSuccess("测试成功!")}).catch(e.$handleError)})},deleteDsById:function(e){var t;t=1===e.isBaseDs?'确认删除数据源<strong class="d-error">"'+e.name+'"</strong>吗?':'确认删除查询引擎<strong class="d-error">"'+e.name+'"</strong>吗?';var s=this;s.$confirmInfo(t,function(){Object(o["e"])({id:e.id}).then(function(e){s.setTableData()}).catch(s.$handleError)})},tableRowClassName:function(e){var t=e.row;e.rowIndex;return t.children&&t.children.length?"success-row":""},openDsOwnerForm:function(e){this.currentDs=e,this.dsOwnerFormVisible=!0,this.setDsOwnerList()},setDsOwnerList:function(){var e=this;this.dsOwnerList=[],Object(o["i"])({id:this.currentDs.id}).then(function(t){e.dsOwnerList=t.data}).catch(this.$handleError)},deleteDsOwnerById:function(e,t){var s=this;Object(o["f"])({dsOwnerId:e}).then(function(e){s.dsOwnerList.splice(t,1)}).catch(this.$handleError)},searchUser:function(e){var t=this;e&&Object(i["g"])({keyword:e}).then(function(e){t.searchUserList=e.data.filter(function(e){var s=t.dsOwnerList.findIndex(function(t){return t.ownerName===e.userName});return-1===s})}).catch(this.$handleError)},addDsOwner:function(e,t){var s=this;Object(o["c"])({dsId:this.currentDs.id,ownerName:e.userName,ownerNameCn:e.userNameCn}).then(function(r){s.dsOwnerList.unshift({id:r.data,ownerName:e.userName,ownerNameCn:e.userNameCn}),s.searchUserList.splice(t,1)}).catch(this.$handleError)},selectUser:function(){this.userNameList=[]}},mounted:function(){this.setTableData()}},l=n,c=(s("0a37"),s("2877")),d=Object(c["a"])(l,r,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-d03ec8aa.4dcc6ef4.js.map