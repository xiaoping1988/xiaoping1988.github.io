(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-09f63fe8"],{"2f20":function(t,e,i){},"30d3":function(t,e,i){"use strict";var a=i("5090"),s=i.n(a);s.a},"33c7":function(t,e,i){"use strict";var a=i("9cb3"),s=i.n(a);s.a},"42bb":function(t,e,i){"use strict";var a=i("49fe"),s=i.n(a);s.a},"49fe":function(t,e,i){},5002:function(t,e,i){"use strict";var a=i("8f56"),s=i.n(a);s.a},5090:function(t,e,i){},"8f56":function(t,e,i){},"9cb3":function(t,e,i){},a921:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-dash-container"},[i("div",{staticClass:"head"},[i("h2",{staticClass:"title"},[t._v(t._s(t.dash.name))]),i("div",{staticClass:"btn"},[t.dash.editAuth?i("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.openAddChart}},[i("i",{staticClass:"fa fa-bar-chart-o d-icon"}),t._v("添加图表\n            ")]):t._e(),t.dash.editAuth?i("el-button",{attrs:{type:"text",size:"mini"}},[i("i",{staticClass:"fa fa-bookmark-o d-icon"}),t._v("添加页签\n            ")]):t._e(),i("el-button",{attrs:{type:"text",size:"mini"}},[i("i",{staticClass:"fa fa-expand d-icon"}),t._v("全屏\n            ")]),t.dash.editAuth?i("el-button",{attrs:{type:"text",size:"mini"}},[i("i",{staticClass:"fa fa-filter d-icon"}),t._v("全局筛选\n            ")]):t._e(),i("el-button",{staticClass:"more",attrs:{type:"text",size:"mini",title:"更多操作"}},[i("i",{staticClass:"fa fa-ellipsis-v d-icon"}),i("ul",{staticClass:"d-btn-list"},[i("li",[t._v("导出仪表盘")]),i("li",[t._v("导出Word")]),i("li",[t._v("导出PDF")])])])],1)]),this.dash.globalFilterList&&this.dash.globalFilterList.length?i("div",{staticClass:"filter"},[i("i",{staticClass:"fa fa-filter d-icon"}),i("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-search"}},[t._v("查询")])],1):t._e(),i("div",{staticClass:"d-dash-main",style:t.dashMainStyle,attrs:{id:"main_"+t.dashId}},[t.hasTab?i("el-tabs",{model:{value:t.activeTabId,callback:function(e){t.activeTabId=e},expression:"activeTabId"}},t._l(t.tabList,function(e){return i("el-tab-pane",{key:e.id,attrs:{label:e.name,name:e.id+""}},[i("DChartList",{attrs:{tabId:e.id,activeTabId:t.activeTabId,activeChartId:t.activeChartId,data:e.chartList,containerWidth:t.containerWidth}})],1)}),1):i("DChartList",{attrs:{tabId:-1,activeTabId:-1,activeChartId:t.activeChartId,data:t.chartList,containerWidth:t.containerWidth}})],1),i("DLoading",{attrs:{loading:t.loading}}),i("el-dialog",{attrs:{visible:t.showAddChartModal,title:"添加图表",top:"30px",width:"360px"},on:{"update:visible":function(e){t.showAddChartModal=e}}},[i("el-row",{staticClass:"d-row"},[t._v("\n            选择图表类型\n        ")]),i("el-row",{staticClass:"d-box-middle d-row"},[i("el-radio-group",{model:{value:t.largeChartType,callback:function(e){t.largeChartType=e},expression:"largeChartType"}},t._l(t.largeChartTypeList,function(e,a){return i("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1),3===t.largeChartType?i("DExternalReportForm",{attrs:{data:t.externalReportForm},on:{submit:t.submitExternalReport,cancel:function(e){t.showAddChartModal=!1}}}):i("DWorkTableSelect",{on:{select:t.selectTable}})],1)],1)},s=[],r=(i("ac6a"),i("8615"),i("a777")),n=i("73cc"),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-dash-chart",attrs:{id:"dash_tab_"+t.tabId}},[i("ul",{staticClass:"d-chart-item-list",attrs:{id:"container_tab_"+t.tabId}},t._l(t.data,function(e){return i("DChartItem",{key:e.id,ref:"chart_item_"+e.id,refInFor:!0,class:{active:e.id+""===t.activeChartId},attrs:{chart:e,visibled:e.visibled},on:{resizing:function(i,a,s){t.resizeChart(e,i,a,s)},"resize-over":function(i,a,s){t.resizeChartOver(e,i,a,s)},moving:function(i,a,s){t.moveChart(e,i,a,s)},"move-over":function(i,a,s){t.moveChartOver(e,i,a,s)}}})}),1)])},l=[],c=(i("c5f6"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("li",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.clickOutside,expression:"clickOutside"}],staticClass:"d-chart-item",class:{"edit-chart":t.chart.editAuth},attrs:{id:"chart_"+t.chart.id},on:{mousedown:t.mouseDownDrag}},[i("DChartContainer",{attrs:{chart:t.chart,globalFilterValue:t.globalFilterValue,resizeCount:t.resizeCount,visibled:t.visibled}}),t.chart.editAuth?i("div",{staticClass:"d-chart-size-btn",attrs:{id:"size_btn_"+t.chart.id},on:{mousedown:t.mouseDownResize}},[i("i",{staticClass:"fa fa-arrow-right"})]):t._e()],1)}),d=[],h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-chart-container"},[t.chart.largeChartType!==t.largeChartTypeObj.External.code?i("div",{staticClass:"head"},[i("div",{staticClass:"left d-ellipsis"},["INDEX_CARD"===t.chartMeta.chartType&&t.showChart?t._e():i("span",{staticClass:"title"},[t._v(t._s(t.chart.name))]),i("span",{staticStyle:{"margin-left":"10px","margin-right":"10px"}},[i("el-tooltip",{attrs:{placement:"bottom",effect:"light"}},[i("div",{staticStyle:{width:"300px","max-height":"400px",overflow:"auto"},attrs:{slot:"content"},slot:"content"},[i("el-row",{staticStyle:{margin:"0px"},attrs:{gutter:24}},[i("el-col",{staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-detail"},[i("h4",[t._v(t._s(1===t.chart.isCertified?"数据部门已认证,数据质量可靠":"未经过数据部门认证"))])])]),i("el-col",{staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-term"},[t._v("标签")]),i("div",{staticClass:"d-desclist-index-detail d-tag-group"},t._l(t.chart.tagList,function(e){return i("el-tag",{key:e.id,attrs:{size:"mini"}},[t._v(t._s(e.name))])}),1)]),i("el-col",{staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-term"},[t._v("描述")]),i("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chart.remark))])]),i("el-col",{staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-term"},[t._v("负责人")]),i("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chart.creatorCn)+"("+t._s(t.chart.creator)+")")])]),i("el-col",{staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-term"},[t._v("负责部门")]),i("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chart.departmentName))])])],1)],1),i("i",{staticClass:"fa fa-trophy grey-icon",class:{"data-certified":1===t.chart.isCertified}})])],1),i("span",[i("el-tooltip",{attrs:{placement:"bottom-start",effect:"light","visible-arrow":!1}},[i("div",{staticStyle:{width:"300px","max-height":"400px",overflow:"auto"},attrs:{slot:"content"},slot:"content"},[i("el-row",{staticStyle:{margin:"0px"},attrs:{gutter:24}},t._l(t.showLabelArr,function(e,a){return""!==e.showLabel&&"全部"!==e.showLabel?i("el-col",{key:a,staticClass:"d-desclist-index"},[i("div",{staticClass:"d-desclist-index-term"},[t._v(t._s(e.showName))]),i("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(e.showLabel))])]):t._e()}),1)],1),i("span",{staticClass:"d-chart-filter-tip"},t._l(t.showLabelArr,function(e,a){return""!==e.showLabel&&"全部"!==e.showLabel?i("span",{key:a,staticClass:"item"},[i("span",{staticClass:"label"},[t._v(t._s(e.showName))]),i("span",{staticClass:"value"},[t._v(t._s(e.showLabel))])]):t._e()}),0)])],1)]),i("div",{staticClass:"right"},[t.chart.editAuth?i("div",{staticClass:"btn",attrs:{title:"编辑报表"}},[i("i",{staticClass:"fa fa-pencil"})]):t._e(),t.filterMeta.length?i("div",{staticClass:"btn filter-btn",on:{mouseenter:t.mouseEnterFilterBtn,mouseleave:t.mouseLeaveFilterBtn}},[i("i",{staticClass:"fa fa-filter"}),i("div",{staticClass:"d-chart-filter-panel",attrs:{id:"filter_panel_"+t.chart.id}},[i("DFilterList",{attrs:{data:t.filterMeta},on:{inited:t.initedFilterList,change:t.changeCondition}})],1)]):t._e(),t._m(0),t._m(1),i("div",{staticClass:"btn more-btn"},[i("i",{staticClass:"fa fa-ellipsis-v"}),i("ul",{staticClass:"d-chart-btn-more d-btn-list"},[i("li",[t._v("导出EXCEL")]),t.chartMeta.chartType!==t.chartTypeObj.IndexCard.code&&t.chartMeta.chartType!==t.chartTypeObj.Table.code?i("li",{on:{click:t.exportImg}},[t._v("导出图片")]):t._e(),i("li",[t._v("刷新数据")]),t.chart.editAuth?i("li",[t._v("复制图表")]):t._e(),t.chart.editAuth?i("li",[t._v("移动图表")]):t._e(),i("li",[t._v("查看SQL")])])])])]):t._e(),i("div",{staticClass:"content d-box-middle",style:t.chartContentStyle,attrs:{id:"chart_content_"+t.chart.id}},[t.chart.largeChartType===t.largeChartTypeObj.External.code?i("div",[t.visibled?i("iframe",{staticClass:"d-chart-external",attrs:{src:t.chart.url}}):t._e()]):t.chart.largeChartType===t.largeChartTypeObj.GpsMap.code?i("div"):i("div",[t.showChart?i("DChartFactory",{attrs:{id:t.chart.id,meta:t.chartMeta,data:t.data,resizeCount:t.resizeCount},on:{sort:t.sortData}}):i("div",{staticClass:"tip"},[t._v("\n                "+t._s(t.tipMsg)+"\n            ")])],1)]),i("DLoading",{attrs:{loading:t.loading}})],1)},u=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"btn"},[i("i",{staticClass:"fa fa-line-chart"})])},function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"btn"},[i("i",{staticClass:"fa fa-sliders"})])}],m=(i("7f7f"),i("4cfb")),f=i("d6be"),p=i("44d2"),v=i("6f7f"),g={name:"DChartContainer",components:{DChartFactory:m["a"],DFilterList:p["a"]},props:{chart:Object,globalFilterValue:String,resizeCount:{type:Number,default:0},visibled:Boolean},computed:{chartContentStyle:function(){return this.chart.largeChartType!==v["d"].External.code?{height:"calc(100% - 32px)"}:{height:"100%"}}},data:function(){return{largeChartTypeObj:v["d"],chartTypeObj:v["a"],chartMeta:{},filterMeta:[],data:[],showChart:!1,tipMsg:"",loading:!1,sortFieldKey:"",sortType:"",chartFilterValue:"[]",lastChartFilterValue:"",conditionValueArr:[],showLabelArr:[],filterInited:!1,filterOperating:!1}},methods:{handleMeta:function(){if(this.chart.largeChartType!==v["d"].External.code){var t=JSON.parse(this.chart.meta);this.chartMeta=t.chartMeta,this.filterMeta=t.filterMeta?t.filterMeta:[],0===this.filterMeta.length&&(this.filterInited=!0)}},sortData:function(t,e){this.sortFieldKey=t,this.sortType=e,this.setData()},setData:function(){var t=this;this.visibled&&this.filterInited&&this.lastChartFilterValue!==this.chartFilterValue&&this.chart.largeChartType!==v["d"].External.code&&(this.loading=!0,this.lastChartFilterValue=this.chartFilterValue,Object(n["c"])({id:this.chart.id,chartFilterValue:this.chartFilterValue,globalFilterValue:this.globalFilterValue,sortFieldKey:this.sortFieldKey,sortType:this.sortType}).then(function(e){t.loading=!1,t.data=e.data,e.data.length?t.showChart=!0:(t.showChart=!1,t.tipMsg="此图表暂无数据")}).catch(function(e){t.$handleError(e),t.loading=!1,t.showChart=!1,t.tipMsg=e.msg,t.data=[]}))},initedFilterList:function(t,e){this.conditionValueArr=t,this.chartFilterValue=JSON.stringify(t),this.showLabelArr=e,this.filterInited=!0,this.setData()},changeCondition:function(t,e){this.conditionValueArr=t,this.chartFilterValue=JSON.stringify(t),this.showLabelArr=e},mouseEnterFilterBtn:function(t){this.filterOperating=!0;var e=window.innerWidth,i=t.clientX,a=document.getElementById("filter_panel_"+this.chart.id);e-i<200?a.style.right="-20px":i-220<200?a.style.left="-20px":a.style.right=-a.clientWidth/2+"px"},mouseLeaveFilterBtn:function(){var t=this;t.filterOperating=!1,setTimeout(function(){t.setData()},100)},exportImg:function(){f["a"].exportImg(this.chart.id,this.chart.name)}},watch:{visibled:function(){this.setData()}},mounted:function(){this.handleMeta()}},b=g,C=(i("33c7"),i("2877")),w=Object(C["a"])(b,h,u,!1,null,null,null),_=w.exports,x={bind:function(t,e,i){function a(i){if(t.contains(i.target))return!1;e.expression&&e.value(i)}t.__vueClickOutside__=a,document.addEventListener("click",a)},update:function(){},unbind:function(t,e){document.removeEventListener("click",t.__vueClickOutside__),delete t.__vueClickOutside__}},y=i("0b85"),z={name:"DChartItem",components:{DChartContainer:_},directives:{clickoutside:x},props:{chart:Object,globalFilterValue:String,visibled:Boolean},data:function(){return{count:0,resizeCount:0,dom:null,isResizing:!1,isMoved:!1}},methods:{clickOutside:function(){this.count=this.count+1,this.count>1&&document.getElementById("chart_"+this.chart.id).classList.remove("active")},mouseMoveResize:function(t){var e=this;e.resizeCount=e.resizeCount+1,e.$emit("resizing",e.dom,t.clientX,t.clientY)},mouseUpResize:function(t){var e=this;e.isResizing=!1,e.$emit("resize-over",e.dom,t.clientX,t.clientY),document.documentElement.removeEventListener("mousemove",e.mouseMoveResize),document.documentElement.removeEventListener("mouseup",e.mouseUpResize)},mouseDownResize:function(t){var e=this;e.isResizing=!0,e.dom=document.getElementById("chart_"+this.chart.id),e.chart.resizeX=t.clientX,e.chart.resizeY=t.clientY,document.documentElement.addEventListener("mousemove",e.mouseMoveResize),document.documentElement.addEventListener("mouseup",e.mouseUpResize)},isInConentDiv:function(t){var e=t.clientX,i=t.clientY,a=document.getElementById("chart_content_"+this.chart.id),s=Object(y["d"])(a),r=s.left,n=s.top,o=r+a.offsetWidth,l=n+a.offsetHeight;return e>r&&e<o&&i>n&&i<l},mouseDownDrag:function(t){var e=this;e.isResizing||!e.chart.editAuth||this.isInConentDiv(t)||(e.dom=document.getElementById("chart_"+this.chart.id),e.chart.dragStartX=t.clientX,e.chart.dragStartY=t.clientY,e.chart.dragStartLeft=e.dom.offsetLeft,e.chart.dragStartTop=e.dom.offsetTop,document.documentElement.addEventListener("mousemove",e.mouseMoveDrag),document.documentElement.addEventListener("mouseup",e.mouseUpDrag))},mouseUpDrag:function(t){var e=this;e.isMoved&&e.$emit("move-over",e.dom,t.clientX,t.clientY),e.isMoved=!1,document.documentElement.removeEventListener("mousemove",e.mouseMoveDrag),document.documentElement.removeEventListener("mouseup",e.mouseUpDrag)},mouseMoveDrag:function(t){var e=this;e.chart.dragStartX===t.clientX&&e.chart.dragStartY===t.clientY||(e.isMoved=!0),e.$emit("moving",e.dom,t.clientX,t.clientY)},addResizeCount:function(){this.resizeCount=this.resizeCount+1}},mounted:function(){}},I=z,R=(i("30d3"),Object(C["a"])(I,c,d,!1,null,null,null)),T=R.exports,L={name:"DChartList",components:{DChartItem:T},props:{containerWidth:Number,tabId:Number,data:Array,activeTabId:[Number,String],activeChartId:[Number,String]},data:function(){return{chartMargin:4,minContainerWidth:980,datumWidth:0,lastScrollTop:0}},methods:{setStyle:function(){this.$nextTick(function(){var t=this;this.data&&(this.datumWidth=this.minContainerWidth>this.containerWidth?this.minContainerWidth:this.containerWidth,this.setContainerHeight(),this.data.forEach(function(e){t.setChartItemStyle(e)}),this.scrollToActiveChart(),this.setChartVisibled())})},setChartItemStyle:function(t){var e=this.datumWidth,i=(e-this.chartMargin*(Math.round(12/t.sizeX)-1))*t.sizeX/12,a=0;t.col>0&&(a=(e-this.chartMargin*(Math.round(12/t.col)-1))*t.col/12+this.chartMargin);var s=e/14*t.sizeY+(t.sizeY-1)*this.chartMargin,r=e/14*t.row+t.row*this.chartMargin,n=document.getElementById("chart_"+t.id);n.style.width=i+"px",n.style.height=s+"px",n.style.top=r+"px",n.style.left=a+"px"},buildOtherChartNewPoisitionFromResize:function(t,e,i,a,s){var r=this,n=this.getChartNewPosition(t,e,i,a,s),o=n.newSizeX,l=n.newSizeY,c=n.newRow,d=n.newCol,h=this.findRightAndDown(t,c,d,o,l),u={};h.forEach(function(t){u[t.id]=t}),h.forEach(function(t){r.recursionFindDown(t,u)}),Object.values(u).forEach(function(t){t.row=t.row+t.addRow,r.setChartItemStyle(t)})},getChartNewPosition:function(t,e,i,a,s){var r=t.sizeX,n=t.sizeY,o=this.datumWidth;e>0&&(r=Math.round(12*(e+this.chartMargin)/(o+this.chartMargin)),r<2&&(r=2)),i>0&&(n=Math.round((i+this.chartMargin)/(o/14+this.chartMargin)),n<2&&(n=2));var l=t.row,c=t.col;return a>=0&&(c=Math.round(12*(a+2*this.chartMargin)/(o+this.chartMargin))),s>=0&&(l=Math.round(s/(o/14+this.chartMargin))),{newRow:l,newCol:c,newSizeX:r,newSizeY:n}},recursionFindDown:function(t,e){var i=this;this.data.forEach(function(a){i.checkChartUpDownOneByOne(t,a)&&(t.addRow>0?e[a.id]?a.addRow=t.addRow>a.addRow?t.addRow:a.addRow:(e[a.id]=a,a.addRow=t.addRow,i.recursionFindDown(a,e)):(t.col>=a.col&&t.col<a.col+a.sizeX||t.col+t.sizeX>a.col&&t.col+t.sizeX<=a.col+a.sizeX||t.col<=a.col&&t.col+t.sizeX>=a.col+a.sizeX)&&(e[a.id]?a.addRow=t.addRow<a.addRow?t.addRow:a.addRow:(e[a.id]=a,a.addRow=t.addRow,i.recursionFindDown(a,e))))})},checkChartUpDownOneByOne:function(t,e){if(e.row===t.row+t.sizeY){if(e.col<t.col+t.sizeX&&e.col>=t.col)return!0;if(t.col<e.col+e.sizeX&&t.col>=e.col)return!0}return!1},checkChartLeftRightOneByOne:function(t,e){if(e.col===t.col+t.sizeX){if(e.row<t.row+t.sizeY&&e.row>=t.row)return!0;if(t.row<e.row+e.sizeY&&t.row>=e.row)return!0}return!1},checkChartVerticalCross:function(t,e){return t.col>=e.col&&t.col<e.col+e.sizeX||t.col+t.sizeX>e.col&&t.col+t.sizeX<=e.col+e.sizeX||t.col<=e.col&&t.col+t.sizeX>=e.col+e.sizeX},findRightAndDown:function(t,e,i,a,s){var r=this,n=[],o=s-t.sizeY;return this.data.forEach(function(l){if(r.checkChartUpDownOneByOne(t,l))if(s>t.sizeY)l.addRow=o,n.push(l);else if(s<t.sizeY||a<t.sizeX){var c={row:0,col:l.col,sizeX:l.sizeX,sizeY:0};r.data.forEach(function(n){if(n.row+n.sizeY<=l.row)if(n.id!==t.id)r.checkChartVerticalCross(l,n)&&c.row+c.sizeY<n.row+n.sizeY&&(c=n);else{var o={row:e,col:i,sizeX:a,sizeY:s};r.checkChartVerticalCross(l,o)&&c.row+c.sizeY<n.row+n.sizeY&&(c={row:e,col:i,sizeX:a,sizeY:s})}}),l.addRow=c.row+c.sizeY-l.row,0!==l.addRow&&n.push(l)}r.checkChartLeftRightOneByOne(t,l)&&a>t.sizeX&&(l.addRow=t.row+s-l.row,n.push(l))}),n},setContainerHeight:function(){var t,e=this.data;e.forEach(function(e){t?t.row+t.sizeY<e.row+e.sizeY&&(t=e):t=e});var i=document.getElementById("container_tab_"+this.tabId),a=this.datumWidth;if(t){var s=t.row+t.sizeY,r=a/14*s+(s-1)*this.chartMargin;i.style.height=r+"px"}},scrollToActiveChart:function(){if(this.activeChartId){var t=document.getElementById("dash_tab_"+this.tabId),e=document.getElementById("chart_"+this.activeChartId);e&&t.scrollTo(0,e.offsetTop)}},setChartVisibled:function(){var t=this,e=document.getElementById("dash_tab_"+this.tabId);this.data.forEach(function(i){var a=document.getElementById("chart_"+i.id),s=0;s=e.scrollTop>=t.lastScrollTop?a.offsetTop+50-e.offsetTop:a.offsetTop+a.clientHeight-50-e.offsetTop;var r=e.scrollTop,n=e.clientHeight;t.tabId===Number(t.activeTabId)&&s>=r&&s<=r+n&&(i.visibled=!0)}),this.lastScrollTop=e.scrollTop,this.$forceUpdate()},resizeChart:function(t,e,i,a){var s=this.getResizeChartNewStyle(t,e,i,a);e.style.width=s.width+"px",e.style.height=s.height+"px",this.buildOtherChartNewPoisitionFromResize(t,s.width,s.height,s.left,s.top),this.setContainerHeight(),this.$nextTick(function(){t.resizeX=i,t.resizeY=a})},getResizeChartNewStyle:function(t,e,i,a){var s=e.clientWidth-(t.resizeX-i),r=e.clientHeight-(t.resizeY-a),n=e.offsetLeft,o=e.offsetTop;return{width:s,height:r,left:n,top:o}},resizeChartOver:function(t,e,i,a){var s=this.getResizeChartNewStyle(t,e,i,a),r=this.getChartNewPosition(t,s.width,s.height,s.left,s.top);t.row=r.newRow,t.col=r.newCol,t.sizeX=r.newSizeX,t.sizeY=r.newSizeY,this.setChartItemStyle(t);var n=this.$refs["chart_item_"+t.id][0];n.addResizeCount(),this.setContainerHeight(),this.updateChartPositions()},getMoveChartNewStyle:function(t,e,i,a){var s=i-t.dragStartX+t.dragStartLeft;s<0?s=0:s>this.datumWidth-e.clientWidth&&(s=this.datumWidth-e.clientWidth);var r=a-t.dragStartY+t.dragStartTop;return r<0&&(r=0),{width:e.clientWidth,height:e.clientHeight,left:s,top:r}},moveChart:function(t,e,i,a){var s=this.getMoveChartNewStyle(t,e,i,a);e.style.left=s.left+"px",e.style.top=s.top+"px"},moveChartOver:function(t,e,i,a){var s=this.getMoveChartNewStyle(t,e,i,a),r=this.getChartNewPosition(t,s.width,s.height,s.left,s.top);t.row=r.newRow,t.col=r.newCol,t.sizeX=r.newSizeX,t.sizeY=r.newSizeY,this.setChartItemStyle(t),this.setContainerHeight(),this.updateChartPositions()},updateChartPositions:function(){var t=[];this.data.forEach(function(e){t.push({id:e.id,row:e.row,col:e.col,sizeX:e.sizeX,sizeY:e.sizeY})}),Object(n["d"])({positions:JSON.stringify(t)}).catch(this.$handleError)},scrollListener:function(){this.setChartVisibled()},resizeWindowListener:function(){this.setChartVisibled()}},watch:{activeTabId:function(){this.setChartVisibled()},data:function(){this.setStyle()},containerWidth:function(){this.setStyle()}},mounted:function(){var t=this;t.setStyle(),document.getElementById("dash_tab_"+t.tabId).addEventListener("scroll",t.scrollListener),window.addEventListener("resize",t.resizeWindowListener)},beforeDestroy:function(){var t=this,e=document.getElementById("dash_tab_"+t.tabId);e&&e.removeEventListener("scroll",t.scrollListener),window.removeEventListener("resize",t.resizeWindowListener)}},E=L,F=(i("5002"),Object(C["a"])(E,o,l,!1,null,null,null)),k=F.exports,D=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"externalReportForm",attrs:{"label-position":"top","label-width":"80px",model:t.externalReportForm,rules:t.externalReportFormRules,size:"mini"}},[i("el-form-item",{attrs:{label:"名称",prop:"name"}},[i("el-input",{model:{value:t.externalReportForm.name,callback:function(e){t.$set(t.externalReportForm,"name",e)},expression:"externalReportForm.name"}})],1),i("el-form-item",{attrs:{label:"URL",prop:"url"}},[i("el-input",{model:{value:t.externalReportForm.url,callback:function(e){t.$set(t.externalReportForm,"url",e)},expression:"externalReportForm.url"}})],1),i("el-form-item",{attrs:{label:"标签"}},[t._l(t.externalReportForm.tagList,function(e,a){return i("el-tag",{key:a,attrs:{closable:"","disable-transitions":!1,size:"small"},on:{close:function(e){return t.delExternalReportTag(a)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}),t.externalReportTagInputVisible?i("el-input",{ref:"saveExternalReportTagInput",staticClass:"d-tag-input",on:{blur:t.saveExternalReportTagConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveExternalReportTagConfirm(e)}},model:{value:t.externalReportTagInputValue,callback:function(e){t.externalReportTagInputValue="string"===typeof e?e.trim():e},expression:"externalReportTagInputValue"}}):i("el-button",{staticClass:"d-tag-input-btn",attrs:{size:"mini"},on:{click:t.showExternalReportTagInput}},[t._v("+ 添加标签")])],2),i("el-form-item",{attrs:{label:"描述",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.externalReportForm.remark,callback:function(e){t.$set(t.externalReportForm,"remark",e)},expression:"externalReportForm.remark"}})],1)],1),i("DSubmitCancel",{attrs:{slot:"footer",nohr:"",size:"mini"},on:{submit:t.submit,cancel:t.cancel},slot:"footer"})],1)},M=[],S=(i("20d6"),{name:"DExternalReportForm",props:{data:Object},data:function(){return{externalReportForm:{url:"",name:"",tagList:[],remark:""},externalReportFormRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:50,message:"长度最大50个字符",trigger:"blur"}],url:[{required:!0,message:"请输入URL",trigger:"blur"},{type:"url",message:"请输入正确的URL",trigger:"blur"}],remark:[{required:!0,message:"请输入描述",trigger:"blur"}]},externalReportTagInputValue:"",externalReportTagInputVisible:!1}},methods:{initForm:function(){this.data&&this.data.id?this.externalReportForm={id:this.data.id,url:this.data.url,name:this.data.name,tagList:this.data.tagList,remark:this.data.remark}:this.externalReportForm={url:"",name:"",tagList:[],remark:""}},cancel:function(){this.$emit("cancel")},submit:function(){var t=this;this.$refs["externalReportForm"].validate(function(e){if(!e)return!1;t.$emit("submit",t.externalReportForm)})},showExternalReportTagInput:function(){var t=this;this.externalReportTagInputVisible=!0,this.$nextTick(function(e){t.$refs.saveExternalReportTagInput.$refs.input.focus()})},saveExternalReportTagConfirm:function(){var t=this.externalReportTagInputValue,e=!0;t&&(t.length>50?(this.$messageWarn("标签长度最大50个字符!"),e=!1):this.externalReportForm.tagList.findIndex(function(e){return e.name===t})>=0?(this.$messageWarn("标签已存在!"),e=!1):this.externalReportForm.tagList.push({name:t})),e&&(this.externalReportTagInputVisible=!1,this.externalReportTagInputValue="")},delExternalReportTag:function(t){this.externalReportForm.tagList.splice(t,1)}},watch:{data:function(){this.initForm()}},mounted:function(){this.initForm()}}),O=S,X=Object(C["a"])(O,D,M,!1,null,null,null),W=X.exports,Y=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-row",{staticClass:"d-row"},[t._v("\n        选择工作表\n    ")]),i("el-row",{staticClass:"d-row"},[i("el-input",{attrs:{size:"mini",clearable:"",placeholder:"搜索工作表","suffix-icon":"el-icon-search"},on:{change:t.searchTable},model:{value:t.tableKeyWord,callback:function(e){t.tableKeyWord="string"===typeof e?e.trim():e},expression:"tableKeyWord"}})],1),i("el-row",{staticClass:"d-row"},[i("div",{staticClass:"d-tb-panel"},[i("ul",{staticClass:"d-tb-list"},t._l(t.searchedTableList,function(e,a){return i("li",{key:a,staticClass:"d-tb-item",on:{click:function(i){return t.selectTable(e)}}},[i("h4",{staticClass:"d-tb-title d-ellipsis",attrs:{title:e.dbName+"."+e.tbName}},[t._v(t._s(e.dbName)+"."+t._s(e.tbName))]),i("div",{staticClass:"d-tb-desc d-ellipsis",attrs:{title:e.tbNameCn}},[t._v(t._s(e.tbNameCn))])])}),0)])])],1)},$=[],V=i("8a52"),N={name:"DWorkTableSelect",data:function(){return{tableKeyWord:"",searchedTableList:[]}},methods:{searchTable:function(){var t=this;Object(V["f"])({tbName:this.tableKeyWord,pageNo:1,pageSize:15}).then(function(e){t.searchedTableList=e.data.data}).catch(this.$handleError)},selectTable:function(t){this.$emit("select",t)}},mounted:function(){this.searchTable()}},A=N,j=(i("42bb"),Object(C["a"])(A,Y,$,!1,null,null,null)),B=j.exports,U={name:"DDashContainer",components:{DChartList:k,DExternalReportForm:W,DWorkTableSelect:B},data:function(){return{projId:"",dashId:"",activeChartId:"",activeTabId:"",dash:{},loading:!1,hasTab:!1,chartList:[],tabList:[],chartMargin:4,containerWidth:980,minContainerWidth:980,showAddChartModal:!1,largeChartType:v["d"].General.code,largeChartTypeList:Object.values(v["d"]),externalReportForm:{url:"",name:"",tagList:[],remark:""}}},computed:{dashMainStyle:function(){var t=45;return this.dash.globalFilterList&&this.dash.globalFilterList.length&&(t+=40),{height:"calc(100% - "+t+"px)"}}},methods:{setActiveIds:function(){var t=this;t.projId=t.$route.params.projId,t.dashId=t.$route.params.dashId,t.activeChartId=t.$route.query.chartId,t.activeTabId=t.$route.query.tabId},renderDash:function(){var t=this;t.loading=!0,t.hasTab=!1,t.chartList=[],t.tabList=[],Object(r["d"])({id:t.dashId}).then(function(e){t.loading=!1,t.dash=e.data,t.dash.tabList&&(t.dash.tabList.length>1||1===t.dash.tabList.length&&-1!==t.dash.tabList[0].id)?(t.hasTab=!0,t.tabList=t.dash.tabList,t.activeTabId||(t.activeTabId=t.tabList[0].id+"")):t.dash.tabList&&t.dash.tabList.length&&(t.chartList=t.dash.tabList[0].chartList)}).catch(t.$handleError)},setContainerWidth:function(){this.$nextTick(function(){var t=document.getElementById("main_"+this.dashId);t&&(this.containerWidth=t.clientWidth-30)})},openAddChart:function(){this.showAddChartModal=!0,this.externalReportForm={url:"",name:"",tagList:[],remark:""}},selectTable:function(t){},submitExternalReport:function(t){var e=this;t.tabId=this.activeTabId,t.dashId=this.dashId,Object(n["b"])(t).then(function(t){e.activeChartId=t.data,e.showAddChartModal=!1,e.renderDash()}).catch(this.$handleError())}},watch:{"$route.path":function(){this.setActiveIds(),this.renderDash()}},mounted:function(){var t=this;t.setActiveIds(),t.renderDash(),t.setContainerWidth(),window.addEventListener("resize",function(){t.setContainerWidth()})}},H=U,P=(i("b139"),Object(C["a"])(H,a,s,!1,null,null,null));e["default"]=P.exports},b139:function(t,e,i){"use strict";var a=i("2f20"),s=i.n(a);s.a}}]);
//# sourceMappingURL=chunk-09f63fe8.2a22abc2.js.map