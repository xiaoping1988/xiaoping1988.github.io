(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d221a71"],{caeb:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("DPageContent",[r("el-card",{attrs:{shadow:"never"}},[r("el-form",{attrs:{inline:""}},[r("el-form-item",[r("el-input",{attrs:{"suffix-icon":"el-icon-search",size:"mini",clearable:"",placeholder:"请输入关键字搜索"},model:{value:e.keyword,callback:function(t){e.keyword="string"===typeof t?t.trim():t},expression:"keyword"}})],1),r("el-form-item",{staticStyle:{float:"right"}},[r("el-button",{attrs:{icon:"el-icon-plus",type:"primary",size:"mini"},on:{click:e.openAddAppFormModal}},[e._v("注册新应用")])],1)],1),r("el-table",{attrs:{data:e.tableData}},[r("el-table-column",{attrs:{prop:"name",label:"名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("router-link",{attrs:{to:"/data-api/app/"+t.row.id}},[e._v(e._s(t.row.name))])]}}])}),r("el-table-column",{attrs:{prop:"code",label:"编码",width:"200"}}),r("el-table-column",{attrs:{prop:"accessKey",width:"220",label:"accessKey"}}),r("el-table-column",{attrs:{prop:"ownerList",width:"220",label:"负责人"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"d-tag-group"},e._l(t.row.ownerList,function(t,a){return r("el-tag",{key:a,attrs:{size:"mini",effect:"plain"}},[e._v("\n                            "+e._s(t.userNameCn)+"("+e._s(t.userName)+")\n                        ")])}),1)]}}])}),r("el-table-column",{attrs:{prop:"remark",label:"描述"}}),r("el-table-column",{attrs:{label:"操作",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(r){return e.openUpdateAppFormModal(t.row)}}},[e._v("编辑")]),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(r){return e.deleteApp(t.row)}}},[e._v("删除")]),r("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(r){return e.openOwner(t.row)}}},[e._v("配置负责人")])]}}])})],1)],1),r("el-dialog",{attrs:{title:e.appForm.id?"编辑应用":"注册新应用",visible:e.showAppFormModal},on:{"update:visible":function(t){e.showAppFormModal=t}}},[r("el-form",{ref:"appForm",attrs:{model:e.appForm,rules:e.appFormRule,size:"mini","label-width":"80px"}},[r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{model:{value:e.appForm.name,callback:function(t){e.$set(e.appForm,"name","string"===typeof t?t.trim():t)},expression:"appForm.name"}})],1),r("el-form-item",{attrs:{label:"编码",prop:"code"}},[r("el-input",{attrs:{placeholder:"字母开头,只能包含字母、数字、下划线"},model:{value:e.appForm.code,callback:function(t){e.$set(e.appForm,"code","string"===typeof t?t.trim():t)},expression:"appForm.code"}})],1),r("el-form-item",{attrs:{label:"描述",prop:"remark"}},[r("el-input",{attrs:{type:"textarea",rows:"4"},model:{value:e.appForm.remark,callback:function(t){e.$set(e.appForm,"remark","string"===typeof t?t.trim():t)},expression:"appForm.remark"}})],1)],1),r("DSubmitCancel",{attrs:{slot:"footer",nohr:"",size:"mini"},on:{submit:e.submitAppForm,cancel:function(t){e.showAppFormModal=!1}},slot:"footer"})],1),r("el-dialog",{attrs:{title:"变更应用[ "+e.currentApp.name+" ]的Owner",visible:e.showAppOwnerModal},on:{"update:visible":function(t){e.showAppOwnerModal=t}}},[r("el-row",{staticStyle:{"margin-bottom":"20px"}},[r("el-select",{staticStyle:{float:"right",width:"220px"},attrs:{filterable:"","reserve-keyword":"",multiple:"",remote:"",placeholder:"请输入用户名或姓名,搜索添加",size:"mini","remote-method":e.searchUser},on:{change:e.selectUser},model:{value:e.userNameList,callback:function(t){e.userNameList=t},expression:"userNameList"}},e._l(e.searchUserList,function(t,a){return r("el-option",{key:t.userName,attrs:{label:t.userNameCn,value:t.userName}},[r("span",{staticStyle:{float:"left"}},[e._v(e._s(t.userNameCn)+"("+e._s(t.userName)+")")]),r("span",{staticStyle:{float:"right"}},[r("el-button",{attrs:{type:"text",title:"添加用户",icon:"el-icon-plus"},on:{click:function(r){return e.addAppOwner(t,a)}}})],1)])}),1)],1),r("el-row",e._l(e.currentApp.ownerList,function(t,a){return r("el-col",{key:t.id,staticClass:"d-hover-btn",attrs:{span:6}},[r("span",[e._v(e._s(t.userNameCn)+"("+e._s(t.userName)+")")]),r("el-button",{attrs:{type:"text",title:"删除用户",icon:"el-icon-delete"},on:{click:function(r){return e.deleteAppOwnerById(t,a)}}})],1)}),1)],1)],1)},n=[],o=(r("20d6"),r("7f7f"),r("6762"),r("2fdb"),r("f958")),s=r("69c6"),i={name:"DApp",data:function(){return{tableData:[],keyword:"",appList:[],loading:!1,showAppFormModal:!1,appForm:{id:"",name:"",code:"",remark:""},appFormRule:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],code:[{required:!0,message:"请输入编码",trigger:"blur"},{type:"string",pattern:/^[A-Za-z]+[A-Za-z0-9_]*[A-Za-z0-9]+$/,message:"字母开头,只能包含字母、数字、下划线",trigger:"blur"}]},showAppOwnerModal:!1,currentApp:{},searchUserList:[],userNameList:[]}},methods:{setAppList:function(){var e=this;this.keyword="",Object(s["g"])().then(function(t){e.appList=t.data,e.searchApp()}).catch(this.$handleError)},searchApp:function(){var e=this;this.keyword?this.tableData=this.appList.filter(function(t){return t.name.includes(e.keyword)||t.code.includes(e.keyword.toUpperCase())||t.remark.includes(e.keyword)}):this.tableData=this.appList},openAddAppFormModal:function(){this.showAppFormModal=!0,this.appForm={name:"",code:"",remark:""}},openUpdateAppFormModal:function(e){this.showAppFormModal=!0,this.appForm={id:e.id,name:e.name,code:e.code,remark:e.remark}},submitAppForm:function(){var e=this;this.$refs["appForm"].validate(function(t){if(!t)return!1;Object(s["b"])(e.appForm).then(function(t){e.showAppFormModal=!1,e.setAppList()}).catch(e.$handleError)})},deleteApp:function(e){var t='确认删除应用<strong class="d-error">"'+e.name+'"</strong>吗?',r=this;r.$confirmInfo(t,function(){Object(s["d"])({id:e.id}).then(function(e){r.setAppList()}).catch(r.$handleError)})},openOwner:function(e){this.showAppOwnerModal=!0,this.currentApp=e},deleteAppOwnerById:function(e,t){var r=this;Object(s["e"])({appOwnerId:e}).then(function(e){r.currentApp.ownerList.splice(t,1)}).catch(this.$handleError)},searchUser:function(e){var t=this;e&&Object(o["g"])({keyword:e}).then(function(e){t.searchUserList=e.data.filter(function(e){var r=t.currentApp.ownerList.findIndex(function(t){return t.userName===e.userName});return-1===r})}).catch(this.$handleError)},addAppOwner:function(e,t){var r=this;Object(s["c"])({appId:this.currentApp.id,userName:e.userName,userNameCn:e.userNameCn}).then(function(a){r.currentApp.ownerList.unshift({id:a.data,appId:r.currentApp.id,userName:e.userName,userNameCn:e.userNameCn}),r.searchUserList.splice(t,1)}).catch(this.$handleError)},selectUser:function(){this.userNameList=[]}},watch:{keyword:function(){this.searchApp()}},mounted:function(){this.setAppList()}},p=i,l=r("2877"),c=Object(l["a"])(p,a,n,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d221a71.68e432b3.js.map