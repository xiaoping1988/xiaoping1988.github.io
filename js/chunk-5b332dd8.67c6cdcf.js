(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5b332dd8"],{"2f20":function(t,e,a){},"30d3":function(t,e,a){"use strict";var i=a("5090"),r=a.n(i);r.a},"33c7":function(t,e,a){"use strict";var i=a("9cb3"),r=a.n(i);r.a},"42bb":function(t,e,a){"use strict";var i=a("49fe"),r=a.n(i);r.a},"49fe":function(t,e,a){},5002:function(t,e,a){"use strict";var i=a("8f56"),r=a.n(i);r.a},5090:function(t,e,a){},"8f56":function(t,e,a){},"9cb3":function(t,e,a){},a921:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-dash-container",class:{"d-dash-full-screen":t.fullScreen}},[a("div",{staticClass:"head"},[a("h2",{staticClass:"title"},[t._v(t._s(t.dash.name))]),a("div",{staticClass:"btn"},[t.dash.editAuth?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.openAddChart}},[a("i",{staticClass:"fa fa-bar-chart-o d-icon"}),t._v("添加图表\n            ")]):t._e(),t.dash.editAuth?a("el-button",{attrs:{type:"text",size:"mini"}},[a("i",{staticClass:"fa fa-bookmark-o d-icon"}),t._v("添加页签\n            ")]):t._e(),t.fullScreen?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.toggleFullScreen}},[a("i",{staticClass:"fa fa-compress d-icon"}),t._v("退出全屏\n            ")]):a("el-button",{attrs:{type:"text",size:"mini"},on:{click:t.toggleFullScreen}},[a("i",{staticClass:"fa fa-expand d-icon"}),t._v("全屏\n            ")]),t.dash.editAuth?a("el-button",{attrs:{type:"text",size:"mini"}},[a("i",{staticClass:"fa fa-filter d-icon"}),t._v("全局筛选\n            ")]):t._e(),a("el-button",{staticClass:"more",attrs:{type:"text",size:"mini",title:"更多操作"}},[a("i",{staticClass:"fa fa-ellipsis-v d-icon"}),a("ul",{staticClass:"d-btn-list"},[a("li",[t._v("导出仪表盘")]),a("li",[t._v("导出Word")]),a("li",[t._v("导出PDF")])])])],1)]),this.dash.globalFilterList&&this.dash.globalFilterList.length?a("div",{staticClass:"filter"},[a("i",{staticClass:"fa fa-filter d-icon"}),a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-search"}},[t._v("查询")])],1):t._e(),a("div",{staticClass:"d-dash-main",style:t.dashMainStyle,attrs:{id:"main_"+t.dashId}},[t.hasTab?a("el-tabs",{model:{value:t.activeTabId,callback:function(e){t.activeTabId=e},expression:"activeTabId"}},t._l(t.tabList,function(e){return a("el-tab-pane",{key:e.id,attrs:{label:e.name,name:e.id+""}},[a("DChartList",{attrs:{tabId:e.id,activeTabId:t.activeTabId,activeChartId:t.activeChartId,data:e.chartList,containerWidth:t.containerWidth}})],1)}),1):a("DChartList",{attrs:{tabId:-1,activeTabId:-1,activeChartId:t.activeChartId,data:t.chartList,containerWidth:t.containerWidth}})],1),a("DLoading",{attrs:{loading:t.loading}}),a("el-dialog",{attrs:{visible:t.showAddChartModal,title:"添加图表",top:"30px",width:"360px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.showAddChartModal=e}}},[a("el-row",{staticClass:"d-row"},[t._v("\n            选择图表类型\n        ")]),a("el-row",{staticClass:"d-box-middle d-row"},[a("el-radio-group",{model:{value:t.largeChartType,callback:function(e){t.largeChartType=e},expression:"largeChartType"}},t._l(t.largeChartTypeList,function(e,i){return a("el-radio",{key:e.code,attrs:{label:e.code}},[t._v(t._s(e.name))])}),1)],1),t.largeChartType===t.largeChartTypeObj.External.code?a("DExternalReportForm",{attrs:{data:t.externalReportForm},on:{submit:t.submitExternalReport,cancel:function(e){t.showAddChartModal=!1}}}):a("DWorkTableSelect",{on:{select:t.selectTable}})],1)],1)},r=[],s=(a("ac6a"),a("8615"),a("a777")),n=a("73cc"),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-dash-chart",attrs:{id:"dash_tab_"+t.tabId}},[a("ul",{staticClass:"d-chart-item-list",attrs:{id:"container_tab_"+t.tabId}},t._l(t.data,function(e){return a("DChartItem",{key:e.id,ref:"chart_item_"+e.id,refInFor:!0,class:{active:e.id+""===t.activeChartId},attrs:{chart:e,visibled:e.visibled},on:{resizing:function(a,i,r){t.resizeChart(e,a,i,r)},"resize-over":function(a,i,r){t.resizeChartOver(e,a,i,r)},moving:function(a,i,r){t.moveChart(e,a,i,r)},"move-over":function(a,i,r){t.moveChartOver(e,a,i,r)}}})}),1)])},l=[],c=(a("c5f6"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.clickOutside,expression:"clickOutside"}],staticClass:"d-chart-item",class:{"edit-chart":t.chart.editAuth},attrs:{id:"chart_"+t.chart.id},on:{mousedown:t.mouseDownDrag}},[a("DChartContainer",{attrs:{chart:t.chart,globalFilterValue:t.globalFilterValue,resizeCount:t.resizeCount,visibled:t.visibled}}),t.chart.editAuth?a("div",{staticClass:"d-chart-size-btn",attrs:{id:"size_btn_"+t.chart.id},on:{mousedown:t.mouseDownResize}},[a("i",{staticClass:"fa fa-arrow-right"})]):t._e()],1)}),d=[],h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"d-chart-container"},[a("div",{staticClass:"head"},[a("div",{staticClass:"left d-ellipsis"},["INDEX_CARD"===t.chartMeta.chartType&&t.showChart?t._e():a("span",{staticClass:"title"},[t._v(t._s(t.chartObj.name))]),a("span",{staticStyle:{"margin-left":"10px","margin-right":"10px"}},[a("el-tooltip",{attrs:{placement:"bottom",effect:"light"}},[a("div",{staticStyle:{width:"300px","max-height":"400px",overflow:"auto"},attrs:{slot:"content"},slot:"content"},[a("el-row",{staticStyle:{margin:"0px"},attrs:{gutter:24}},[a("el-col",{staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-detail"},[a("h4",[t._v(t._s(1===t.chartObj.isCertified?"数据部门已认证,数据质量可靠":"未经过数据部门认证"))])])]),a("el-col",{staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-term"},[t._v("标签")]),a("div",{staticClass:"d-desclist-index-detail d-tag-group"},t._l(t.chartObj.tagList,function(e){return a("el-tag",{key:e.id,attrs:{size:"mini"}},[t._v(t._s(e.name))])}),1)]),a("el-col",{staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-term"},[t._v("描述")]),a("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chartObj.remark))])]),a("el-col",{staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-term"},[t._v("负责人")]),a("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chartObj.creatorCn)+"("+t._s(t.chartObj.creator)+")")])]),a("el-col",{staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-term"},[t._v("负责部门")]),a("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(t.chartObj.departmentName))])])],1)],1),a("i",{staticClass:"fa fa-trophy grey-icon",class:{"data-certified":1===t.chartObj.isCertified}})])],1),t.chart.largeChartType!==t.largeChartTypeObj.External.code?a("span",[a("el-tooltip",{attrs:{placement:"bottom-start",effect:"light","visible-arrow":!1}},[a("div",{staticStyle:{width:"300px","max-height":"400px",overflow:"auto"},attrs:{slot:"content"},slot:"content"},[a("el-row",{staticStyle:{margin:"0px"},attrs:{gutter:24}},t._l(t.showLabelArr,function(e,i){return""!==e.showLabel&&"全部"!==e.showLabel?a("el-col",{key:i,staticClass:"d-desclist-index"},[a("div",{staticClass:"d-desclist-index-term"},[t._v(t._s(e.colLabel))]),a("div",{staticClass:"d-desclist-index-detail"},[t._v(t._s(e.showLabel))])]):t._e()}),1)],1),a("span",{staticClass:"d-chart-filter-tip"},t._l(t.showLabelArr,function(e,i){return""!==e.showLabel&&"全部"!==e.showLabel?a("span",{key:i,staticClass:"item"},[a("span",{staticClass:"label"},[t._v(t._s(e.colLabel))]),a("span",{staticClass:"value"},[t._v(t._s(e.showLabel))])]):t._e()}),0)])],1):t._e()]),a("div",{staticClass:"right"},[t.chart.editAuth?a("div",{staticClass:"btn",attrs:{title:"编辑报表"},on:{click:t.openChartEdit}},[a("i",{staticClass:"fa fa-pencil"})]):t._e(),t.filterMeta.length&&t.chart.largeChartType!==t.largeChartTypeObj.External.code?a("div",{staticClass:"btn filter-btn",on:{mouseenter:t.mouseEnterFilterBtn,mouseleave:t.mouseLeaveFilterBtn}},[a("i",{staticClass:"fa fa-filter"}),a("div",{staticClass:"d-chart-filter-panel",attrs:{id:"filter_panel_"+t.chart.id}},[a("DFilterList",{attrs:{data:t.filterMeta},on:{inited:t.initedFilterList,change:t.changeCondition}})],1)]):t._e(),t.chart.largeChartType===t.largeChartTypeObj.General.code?a("div",{staticClass:"btn",attrs:{title:"图类型切换"}},[a("i",{staticClass:"fa fa-line-chart"})]):t._e(),t.chart.largeChartType===t.largeChartTypeObj.General.code?a("div",{staticClass:"btn",attrs:{title:"维度指标切换"}},[a("i",{staticClass:"fa fa-sliders"})]):t._e(),t._m(0),t.chart.largeChartType!==t.largeChartTypeObj.External.code?a("div",{staticClass:"btn more-btn"},[a("i",{staticClass:"fa fa-ellipsis-v"}),a("ul",{staticClass:"d-chart-btn-more d-btn-list"},[a("li",[t._v("导出EXCEL")]),t.chartMeta.chartType!==t.chartTypeObj.IndexCard.code&&t.chartMeta.chartType!==t.chartTypeObj.Table.code?a("li",{on:{click:t.exportImg}},[t._v("导出图片")]):t._e(),a("li",[t._v("刷新数据")]),t.chart.editAuth?a("li",[t._v("复制图表")]):t._e(),t.chart.editAuth?a("li",[t._v("移动图表")]):t._e(),a("li",[t._v("查看SQL")])])]):t._e()])]),a("div",{staticClass:"content d-box-middle",attrs:{id:"chart_content_"+t.chart.id}},[t.chart.largeChartType===t.largeChartTypeObj.External.code?a("div",[t.visibled?a("iframe",{staticClass:"d-chart-external",attrs:{src:t.chartObj.url}}):t._e()]):t.chart.largeChartType===t.largeChartTypeObj.GpsMap.code?a("div"):a("div",[t.showChart?a("DChartFactory",{attrs:{id:t.chart.id,meta:t.chartMeta,data:t.data,resizeCount:t.resizeCount},on:{sort:t.sortData}}):a("div",{staticClass:"tip"},[t._v("\n                "+t._s(t.tipMsg)+"\n            ")])],1)]),a("DLoading",{attrs:{loading:t.loading}}),t.chart.largeChartType===t.largeChartTypeObj.External.code?a("el-dialog",{attrs:{visible:t.showEditChartModal,title:"编辑图表",top:"30px",width:"360px","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.showEditChartModal=e}}},[a("DExternalReportForm",{attrs:{data:t.externalReportForm},on:{submit:t.submitExternalReport,cancel:function(e){t.showEditChartModal=!1}}})],1):t._e()],1)},u=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"btn",attrs:{title:"全屏"}},[a("i",{staticClass:"fa fa-expand"})])}],m=(a("7f7f"),a("4cfb")),f=a("d6be"),p=a("44d2"),b=a("6f7f"),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-form",{ref:"externalReportForm",attrs:{"label-position":"top","label-width":"80px",model:t.externalReportForm,rules:t.externalReportFormRules,size:"mini"}},[a("el-form-item",{attrs:{label:"名称",prop:"name"}},[a("el-input",{model:{value:t.externalReportForm.name,callback:function(e){t.$set(t.externalReportForm,"name",e)},expression:"externalReportForm.name"}})],1),a("el-form-item",{attrs:{label:"URL",prop:"url"}},[a("el-input",{model:{value:t.externalReportForm.url,callback:function(e){t.$set(t.externalReportForm,"url",e)},expression:"externalReportForm.url"}})],1),a("el-form-item",{attrs:{label:"标签"}},[t._l(t.externalReportForm.tagList,function(e,i){return a("el-tag",{key:i,attrs:{closable:"","disable-transitions":!1,size:"small"},on:{close:function(e){return t.delExternalReportTag(i)}}},[t._v("\n                "+t._s(e.name)+"\n            ")])}),t.externalReportTagInputVisible?a("el-input",{ref:"saveExternalReportTagInput",staticClass:"d-tag-input",on:{blur:t.saveExternalReportTagConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.saveExternalReportTagConfirm(e)}},model:{value:t.externalReportTagInputValue,callback:function(e){t.externalReportTagInputValue="string"===typeof e?e.trim():e},expression:"externalReportTagInputValue"}}):a("el-button",{staticClass:"d-tag-input-btn",attrs:{size:"mini"},on:{click:t.showExternalReportTagInput}},[t._v("+ 添加标签")])],2),a("el-form-item",{attrs:{label:"描述",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.externalReportForm.remark,callback:function(e){t.$set(t.externalReportForm,"remark",e)},expression:"externalReportForm.remark"}})],1)],1),a("DSubmitCancel",{attrs:{slot:"footer",nohr:"",size:"mini"},on:{submit:t.submit,cancel:t.cancel},slot:"footer"})],1)},g=[],C=(a("20d6"),{name:"DExternalReportForm",props:{data:Object},data:function(){return{externalReportForm:{url:"",name:"",tagList:[],remark:""},externalReportFormRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:50,message:"长度最大50个字符",trigger:"blur"}],url:[{required:!0,message:"请输入URL",trigger:"blur"},{type:"url",message:"请输入正确的URL",trigger:"blur"}],remark:[{required:!0,message:"请输入描述",trigger:"blur"}]},externalReportTagInputValue:"",externalReportTagInputVisible:!1}},methods:{initForm:function(){this.data&&this.data.id?this.externalReportForm={id:this.data.id,url:this.data.url,name:this.data.name,tagList:this.data.tagList,remark:this.data.remark}:this.externalReportForm={url:"",name:"",tagList:[],remark:""}},cancel:function(){this.$emit("cancel")},submit:function(){var t=this;this.$refs["externalReportForm"].validate(function(e){if(!e)return!1;t.$emit("submit",t.externalReportForm)})},showExternalReportTagInput:function(){var t=this;this.externalReportTagInputVisible=!0,this.$nextTick(function(e){t.$refs.saveExternalReportTagInput.$refs.input.focus()})},saveExternalReportTagConfirm:function(){var t=this.externalReportTagInputValue,e=!0;t&&(t.length>50?(this.$messageWarn("标签长度最大50个字符!"),e=!1):this.externalReportForm.tagList.findIndex(function(e){return e.name===t})>=0?(this.$messageWarn("标签已存在!"),e=!1):this.externalReportForm.tagList.push({name:t})),e&&(this.externalReportTagInputVisible=!1,this.externalReportTagInputValue="")},delExternalReportTag:function(t){this.externalReportForm.tagList.splice(t,1)}},watch:{data:function(){this.initForm()}},mounted:function(){this.initForm()}}),w=C,x=a("2877"),_=Object(x["a"])(w,v,g,!1,null,null,null),y=_.exports,z={name:"DChartContainer",components:{DChartFactory:m["a"],DFilterList:p["a"],DExternalReportForm:y},props:{chart:Object,globalFilterValue:String,resizeCount:{type:Number,default:0},visibled:Boolean},data:function(){return{chartObj:this.chart,largeChartTypeObj:b["g"],chartTypeObj:b["b"],chartMeta:{},filterMeta:[],data:[],showChart:!1,tipMsg:"",loading:!1,sortFieldKey:"",sortType:"",chartFilterValue:"[]",lastChartFilterValue:"",conditionValueArr:[],showLabelArr:[],filterInited:!1,filterOperating:!1,showEditChartModal:!1,externalReportForm:{id:"",url:"",name:"",tagList:[],remark:""}}},methods:{handleMeta:function(){if(this.chart.largeChartType!==b["g"].External.code){var t=JSON.parse(this.chart.renderMeta);this.chartMeta=t.chartMeta,this.filterMeta=t.filterMeta?t.filterMeta:[],0===this.filterMeta.length&&(this.filterInited=!0)}},sortData:function(t,e){this.sortFieldKey=t,this.sortType=e,this.setData()},setData:function(){var t=this;this.visibled&&this.filterInited&&this.lastChartFilterValue!==this.chartFilterValue&&this.chart.largeChartType!==b["g"].External.code&&(this.loading=!0,this.lastChartFilterValue=this.chartFilterValue,Object(n["g"])({id:this.chart.id,chartFilterValue:this.chartFilterValue,globalFilterValue:this.globalFilterValue,sortFieldKey:this.sortFieldKey,sortType:this.sortType}).then(function(e){t.loading=!1,t.data=e.data,e.data.length?t.showChart=!0:(t.showChart=!1,t.tipMsg="此图表暂无数据")}).catch(function(e){t.$handleError(e),t.loading=!1,t.showChart=!1,t.tipMsg=e.msg,t.data=[]}))},initedFilterList:function(t,e){this.conditionValueArr=t,this.chartFilterValue=JSON.stringify(t),this.showLabelArr=e,this.filterInited=!0,this.setData()},changeCondition:function(t,e){this.conditionValueArr=t,this.chartFilterValue=JSON.stringify(t),this.showLabelArr=e},mouseEnterFilterBtn:function(t){this.filterOperating=!0;var e=window.innerWidth,a=t.clientX,i=document.getElementById("filter_panel_"+this.chart.id);e-a<200?i.style.right="-20px":a-220<200?i.style.left="-20px":i.style.right=-i.clientWidth/2+"px"},mouseLeaveFilterBtn:function(){var t=this;t.filterOperating=!1,setTimeout(function(){t.setData()},100)},exportImg:function(){f["a"].exportImg(this.chart.id,this.chart.name)},openChartEdit:function(){this.chart.largeChartType===b["g"].General.code?this.$router.push({path:"/chart-design",query:{chartId:this.chart.id}}):this.chart.largeChartType===b["g"].GpsMap.code||this.chart.largeChartType===b["g"].External.code&&(this.showEditChartModal=!0,this.externalReportForm={id:this.chartObj.id,name:this.chartObj.name,url:this.chartObj.url,remark:this.chartObj.remark,tagList:this.chartObj.tagList})},submitExternalReport:function(t){var e=this;Object(n["b"])(t).then(function(t){e.activeChartId=t.data,e.showEditChartModal=!1,e.setChartObj(t.data)}).catch(this.$handleError)},setChartObj:function(t){var e=this;Object(n["d"])({id:t}).then(function(t){e.chartObj=t.data}).catch(this.$handleError)}},watch:{visibled:function(){this.setData()}},mounted:function(){this.handleMeta()}},T=z,I=(a("33c7"),Object(x["a"])(T,h,u,!1,null,null,null)),R=I.exports,E={bind:function(t,e,a){function i(a){if(t.contains(a.target))return!1;e.expression&&e.value(a)}t.__vueClickOutside__=i,document.addEventListener("click",i)},update:function(){},unbind:function(t,e){document.removeEventListener("click",t.__vueClickOutside__),delete t.__vueClickOutside__}},L=a("0b85"),O={name:"DChartItem",components:{DChartContainer:R},directives:{clickoutside:E},props:{chart:Object,globalFilterValue:String,visibled:Boolean},data:function(){return{count:0,resizeCount:0,dom:null,isResizing:!1,isMoved:!1}},methods:{clickOutside:function(){this.count=this.count+1,this.count>1&&document.getElementById("chart_"+this.chart.id).classList.remove("active")},mouseMoveResize:function(t){var e=this;e.resizeCount=e.resizeCount+1,e.$emit("resizing",e.dom,t.clientX,t.clientY)},mouseUpResize:function(t){var e=this;e.isResizing=!1,e.$emit("resize-over",e.dom,t.clientX,t.clientY),document.documentElement.removeEventListener("mousemove",e.mouseMoveResize),document.documentElement.removeEventListener("mouseup",e.mouseUpResize)},mouseDownResize:function(t){var e=this;e.isResizing=!0,e.dom=document.getElementById("chart_"+this.chart.id),e.chart.resizeX=t.clientX,e.chart.resizeY=t.clientY,document.documentElement.addEventListener("mousemove",e.mouseMoveResize),document.documentElement.addEventListener("mouseup",e.mouseUpResize)},isInConentDiv:function(t){var e=t.clientX,a=t.clientY,i=document.getElementById("chart_content_"+this.chart.id),r=Object(L["d"])(i),s=r.left,n=r.top,o=s+i.offsetWidth,l=n+i.offsetHeight;return e>s&&e<o&&a>n&&a<l},mouseDownDrag:function(t){var e=this;e.isResizing||!e.chart.editAuth||this.isInConentDiv(t)||(e.dom=document.getElementById("chart_"+this.chart.id),e.chart.dragStartX=t.clientX,e.chart.dragStartY=t.clientY,e.chart.dragStartLeft=e.dom.offsetLeft,e.chart.dragStartTop=e.dom.offsetTop,document.documentElement.addEventListener("mousemove",e.mouseMoveDrag),document.documentElement.addEventListener("mouseup",e.mouseUpDrag))},mouseUpDrag:function(t){var e=this;e.isMoved&&e.$emit("move-over",e.dom,t.clientX,t.clientY),e.isMoved=!1,document.documentElement.removeEventListener("mousemove",e.mouseMoveDrag),document.documentElement.removeEventListener("mouseup",e.mouseUpDrag)},mouseMoveDrag:function(t){var e=this;e.chart.dragStartX===t.clientX&&e.chart.dragStartY===t.clientY||(e.isMoved=!0),e.$emit("moving",e.dom,t.clientX,t.clientY)},addResizeCount:function(){this.resizeCount=this.resizeCount+1}},mounted:function(){}},F=O,k=(a("30d3"),Object(x["a"])(F,c,d,!1,null,null,null)),M=k.exports,D={name:"DChartList",components:{DChartItem:M},props:{containerWidth:Number,tabId:Number,data:Array,activeTabId:[Number,String],activeChartId:[Number,String]},data:function(){return{chartMargin:4,minContainerWidth:980,datumWidth:0,lastScrollTop:0}},methods:{setStyle:function(){this.$nextTick(function(){var t=this;this.data&&(this.datumWidth=this.minContainerWidth>this.containerWidth?this.minContainerWidth:this.containerWidth,this.setContainerHeight(),this.data.forEach(function(e){t.setChartItemStyle(e)}),this.scrollToActiveChart(),this.setChartVisibled())})},setChartItemStyle:function(t){var e=this.datumWidth,a=(e-this.chartMargin*(Math.round(12/t.sizeX)-1))*t.sizeX/12,i=0;t.col>0&&(i=(e-this.chartMargin*(Math.round(12/t.col)-1))*t.col/12+this.chartMargin);var r=e/14*t.sizeY+(t.sizeY-1)*this.chartMargin,s=e/14*t.row+t.row*this.chartMargin,n=document.getElementById("chart_"+t.id);n.style.width=a+"px",n.style.height=r+"px",n.style.top=s+"px",n.style.left=i+"px"},buildOtherChartNewPoisitionFromResize:function(t,e,a,i,r){var s=this,n=this.getChartNewPosition(t,e,a,i,r),o=n.newSizeX,l=n.newSizeY,c=n.newRow,d=n.newCol,h=this.findRightAndDown(t,c,d,o,l),u={};h.forEach(function(t){u[t.id]=t}),h.forEach(function(t){s.recursionFindDown(t,u)}),Object.values(u).forEach(function(t){t.row=t.row+t.addRow,s.setChartItemStyle(t)})},getChartNewPosition:function(t,e,a,i,r){var s=t.sizeX,n=t.sizeY,o=this.datumWidth;e>0&&(s=Math.round(12*(e+this.chartMargin)/(o+this.chartMargin)),s<2&&(s=2)),a>0&&(n=Math.round((a+this.chartMargin)/(o/14+this.chartMargin)),n<2&&(n=2));var l=t.row,c=t.col;return i>=0&&(c=Math.round(12*(i+2*this.chartMargin)/(o+this.chartMargin))),r>=0&&(l=Math.round(r/(o/14+this.chartMargin))),{newRow:l,newCol:c,newSizeX:s,newSizeY:n}},recursionFindDown:function(t,e){var a=this;this.data.forEach(function(i){a.checkChartUpDownOneByOne(t,i)&&(t.addRow>0?e[i.id]?i.addRow=t.addRow>i.addRow?t.addRow:i.addRow:(e[i.id]=i,i.addRow=t.addRow,a.recursionFindDown(i,e)):(t.col>=i.col&&t.col<i.col+i.sizeX||t.col+t.sizeX>i.col&&t.col+t.sizeX<=i.col+i.sizeX||t.col<=i.col&&t.col+t.sizeX>=i.col+i.sizeX)&&(e[i.id]?i.addRow=t.addRow<i.addRow?t.addRow:i.addRow:(e[i.id]=i,i.addRow=t.addRow,a.recursionFindDown(i,e))))})},checkChartUpDownOneByOne:function(t,e){if(e.row===t.row+t.sizeY){if(e.col<t.col+t.sizeX&&e.col>=t.col)return!0;if(t.col<e.col+e.sizeX&&t.col>=e.col)return!0}return!1},checkChartLeftRightOneByOne:function(t,e){if(e.col===t.col+t.sizeX){if(e.row<t.row+t.sizeY&&e.row>=t.row)return!0;if(t.row<e.row+e.sizeY&&t.row>=e.row)return!0}return!1},checkChartVerticalCross:function(t,e){return t.col>=e.col&&t.col<e.col+e.sizeX||t.col+t.sizeX>e.col&&t.col+t.sizeX<=e.col+e.sizeX||t.col<=e.col&&t.col+t.sizeX>=e.col+e.sizeX},findRightAndDown:function(t,e,a,i,r){var s=this,n=[],o=r-t.sizeY;return this.data.forEach(function(l){if(s.checkChartUpDownOneByOne(t,l))if(r>t.sizeY)l.addRow=o,n.push(l);else if(r<t.sizeY||i<t.sizeX){var c={row:0,col:l.col,sizeX:l.sizeX,sizeY:0};s.data.forEach(function(n){if(n.row+n.sizeY<=l.row)if(n.id!==t.id)s.checkChartVerticalCross(l,n)&&c.row+c.sizeY<n.row+n.sizeY&&(c=n);else{var o={row:e,col:a,sizeX:i,sizeY:r};s.checkChartVerticalCross(l,o)&&c.row+c.sizeY<n.row+n.sizeY&&(c={row:e,col:a,sizeX:i,sizeY:r})}}),l.addRow=c.row+c.sizeY-l.row,0!==l.addRow&&n.push(l)}s.checkChartLeftRightOneByOne(t,l)&&i>t.sizeX&&(l.addRow=t.row+r-l.row,n.push(l))}),n},setContainerHeight:function(){var t,e=this.data;e.forEach(function(e){t?t.row+t.sizeY<e.row+e.sizeY&&(t=e):t=e});var a=document.getElementById("container_tab_"+this.tabId),i=this.datumWidth;if(t){var r=t.row+t.sizeY,s=i/14*r+(r-1)*this.chartMargin;a.style.height=s+"px"}},scrollToActiveChart:function(){if(this.activeChartId){var t=document.getElementById("dash_tab_"+this.tabId),e=document.getElementById("chart_"+this.activeChartId);e&&t.scrollTo(0,e.offsetTop)}},setChartVisibled:function(){var t=this,e=document.getElementById("dash_tab_"+this.tabId);this.data.forEach(function(a){var i=document.getElementById("chart_"+a.id),r=0;r=e.scrollTop>=t.lastScrollTop?i.offsetTop+50-e.offsetTop:i.offsetTop+i.clientHeight-50-e.offsetTop;var s=e.scrollTop,n=e.clientHeight;t.tabId===Number(t.activeTabId)&&r>=s&&r<=s+n&&(a.visibled=!0)}),this.lastScrollTop=e.scrollTop,this.$forceUpdate()},resizeChart:function(t,e,a,i){var r=this.getResizeChartNewStyle(t,e,a,i);e.style.width=r.width+"px",e.style.height=r.height+"px",this.buildOtherChartNewPoisitionFromResize(t,r.width,r.height,r.left,r.top),this.setContainerHeight(),this.$nextTick(function(){t.resizeX=a,t.resizeY=i})},getResizeChartNewStyle:function(t,e,a,i){var r=e.clientWidth-(t.resizeX-a),s=e.clientHeight-(t.resizeY-i),n=e.offsetLeft,o=e.offsetTop;return{width:r,height:s,left:n,top:o}},resizeChartOver:function(t,e,a,i){var r=this.getResizeChartNewStyle(t,e,a,i),s=this.getChartNewPosition(t,r.width,r.height,r.left,r.top);t.row=s.newRow,t.col=s.newCol,t.sizeX=s.newSizeX,t.sizeY=s.newSizeY,this.setChartItemStyle(t);var n=this.$refs["chart_item_"+t.id][0];n.addResizeCount(),this.setContainerHeight(),this.updateChartPositions()},getMoveChartNewStyle:function(t,e,a,i){var r=a-t.dragStartX+t.dragStartLeft;r<0?r=0:r>this.datumWidth-e.clientWidth&&(r=this.datumWidth-e.clientWidth);var s=i-t.dragStartY+t.dragStartTop;return s<0&&(s=0),{width:e.clientWidth,height:e.clientHeight,left:r,top:s}},moveChart:function(t,e,a,i){var r=this.getMoveChartNewStyle(t,e,a,i);e.style.left=r.left+"px",e.style.top=r.top+"px"},moveChartOver:function(t,e,a,i){var r=this.getMoveChartNewStyle(t,e,a,i),s=this.getChartNewPosition(t,r.width,r.height,r.left,r.top);t.row=s.newRow,t.col=s.newCol,t.sizeX=s.newSizeX,t.sizeY=s.newSizeY,this.setChartItemStyle(t),this.setContainerHeight(),this.updateChartPositions()},updateChartPositions:function(){var t=[];this.data.forEach(function(e){t.push({id:e.id,row:e.row,col:e.col,sizeX:e.sizeX,sizeY:e.sizeY})}),Object(n["h"])({positions:JSON.stringify(t)}).catch(this.$handleError)},scrollListener:function(){this.setChartVisibled()},resizeWindowListener:function(){this.setChartVisibled()}},watch:{activeTabId:function(){this.setChartVisibled()},data:function(){this.setStyle()},containerWidth:function(){this.setStyle()}},mounted:function(){var t=this;t.setStyle(),document.getElementById("dash_tab_"+t.tabId).addEventListener("scroll",t.scrollListener),window.addEventListener("resize",t.resizeWindowListener)},beforeDestroy:function(){var t=this,e=document.getElementById("dash_tab_"+t.tabId);e&&e.removeEventListener("scroll",t.scrollListener),window.removeEventListener("resize",t.resizeWindowListener)}},S=D,j=(a("5002"),Object(x["a"])(S,o,l,!1,null,null,null)),X=j.exports,W=a("d45b"),Y={name:"DDashContainer",components:{DChartList:X,DExternalReportForm:y,DWorkTableSelect:W["a"]},data:function(){return{projId:"",dashId:"",activeChartId:"",activeTabId:"",dash:{},loading:!1,hasTab:!1,chartList:[],tabList:[],chartMargin:4,containerWidth:980,minContainerWidth:980,showAddChartModal:!1,largeChartTypeObj:b["g"],largeChartType:b["g"].General.code,largeChartTypeList:Object.values(b["g"]),externalReportForm:{url:"",name:"",tagList:[],remark:""},fullScreen:!1}},computed:{dashMainStyle:function(){var t=45;return this.dash.globalFilterList&&this.dash.globalFilterList.length&&(t+=40),{height:"calc(100% - "+t+"px)"}}},methods:{setActiveIds:function(){var t=this;t.projId=t.$route.params.projId,t.dashId=t.$route.params.dashId,t.activeChartId=t.$route.query.chartId,t.$route.query.tabId&&(t.activeTabId=t.$route.query.tabId+"")},renderDash:function(){var t=this;t.loading=!0,t.hasTab=!1,t.chartList=[],t.tabList=[],Object(s["d"])({id:t.dashId}).then(function(e){t.loading=!1,t.dash=e.data,t.dash.tabList&&(t.dash.tabList.length>1||1===t.dash.tabList.length&&-1!==t.dash.tabList[0].id)?(t.hasTab=!0,t.tabList=t.dash.tabList,t.activeTabId||(t.activeTabId=t.tabList[0].id+"")):t.dash.tabList&&t.dash.tabList.length&&(t.chartList=t.dash.tabList[0].chartList),t.hasTab||(t.activeTabId="-1")}).catch(t.$handleError)},setContainerWidth:function(){this.$nextTick(function(){var t=document.getElementById("main_"+this.dashId);t&&(this.containerWidth=t.clientWidth-30)})},openAddChart:function(){this.showAddChartModal=!0,this.externalReportForm={url:"",name:"",tagList:[],remark:""}},selectTable:function(t){this.largeChartType===b["g"].General.code?this.$router.push({path:"/chart-design",query:{tbId:t.id,dashId:this.dashId,tabId:this.activeTabId,projId:this.projId}}):(this.largeChartType,b["g"].GpsMap.code)},submitExternalReport:function(t){var e=this;t.tabId=this.activeTabId,t.dashId=this.dashId,Object(n["b"])(t).then(function(t){e.activeChartId=t.data,e.showAddChartModal=!1,e.renderDash()}).catch(this.$handleError)},toggleFullScreen:function(){this.fullScreen=!this.fullScreen,this.setContainerWidth()}},watch:{"$route.path":function(){this.setActiveIds(),this.renderDash()}},mounted:function(){var t=this;t.setActiveIds(),t.renderDash(),t.setContainerWidth(),window.addEventListener("resize",function(){t.setContainerWidth()})}},$=Y,V=(a("b139"),Object(x["a"])($,i,r,!1,null,null,null));e["default"]=V.exports},b139:function(t,e,a){"use strict";var i=a("2f20"),r=a.n(i);r.a},d45b:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("el-row",{staticClass:"d-row"},[t._v("\n        选择工作表\n    ")]),a("el-row",{staticClass:"d-row"},[a("el-input",{attrs:{size:"mini",clearable:"",placeholder:"搜索工作表","suffix-icon":"el-icon-search"},on:{change:t.searchTable},model:{value:t.tableKeyWord,callback:function(e){t.tableKeyWord="string"===typeof e?e.trim():e},expression:"tableKeyWord"}})],1),a("el-row",{staticClass:"d-row"},[a("div",{staticClass:"d-tb-panel"},[a("ul",{staticClass:"d-tb-list"},t._l(t.searchedTableList,function(e,i){return a("li",{key:i,staticClass:"d-tb-item",on:{click:function(a){return t.selectTable(e)}}},[a("h4",{staticClass:"d-tb-title d-ellipsis",attrs:{title:e.dbName+"."+e.tbName}},[t._v(t._s(e.dbName)+"."+t._s(e.tbName))]),a("div",{staticClass:"d-tb-desc d-ellipsis",attrs:{title:e.tbNameCn}},[t._v(t._s(e.tbNameCn))])])}),0)])])],1)},r=[],s=a("8a52"),n={name:"DWorkTableSelect",data:function(){return{tableKeyWord:"",searchedTableList:[]}},methods:{searchTable:function(){var t=this;Object(s["f"])({tbName:this.tableKeyWord,pageNo:1,pageSize:15}).then(function(e){t.searchedTableList=e.data.data}).catch(this.$handleError)},selectTable:function(t){this.$emit("select",t)}},mounted:function(){this.searchTable()}},o=n,l=(a("42bb"),a("2877")),c=Object(l["a"])(o,i,r,!1,null,null,null);e["a"]=c.exports}}]);
//# sourceMappingURL=chunk-5b332dd8.67c6cdcf.js.map